<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Introduction - Eugene Documentation</title>


        <!-- Custom HTML head -->
        <!-- Silly hack to fix non-loading assets at /eugene -->
        <script type="application/javascript">
            if (window.location.pathname === '/eugene') {
                window.location.pathname = '/eugene/';
            }
        </script>
        <!-- plausible.io is a privacy-friendly analytics, we want to count visitors to pages -->
        <script defer data-domain="kaveland.no" src="https://plausible.io/js/script.js"></script>
        <script src="https://unpkg.com/htmx.org@1.9.12"></script>
        

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/custom.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Eugene Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/kaaveland/eugene" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction-to-eugene"><a class="header" href="#introduction-to-eugene">Introduction to eugene</a></h1>
<p>Eugene helps you write zero downtime schema migration scripts for PostgreSQL databases.
Sometimes, the most straightforward way to make a change to your database schema is
also quite risky, due to locking issues and lock queues. Eugene has two modes that can
help you spot dangerous patterns and can suggest a safer way to achieve the same effect
in many cases, and it is easy to get started with both:</p>
<ul>
<li><code>eugene lint</code> will perform syntax tree analysis of your SQL script using the PostgreSQL parser.</li>
<li><code>eugene trace</code> run your scripts in a temporary PostgreSQL server, and inspect locks.</li>
<li>Both understand git and can easily check only what's new on your branch, commit or tag.</li>
<li>Both handle folders with version named scripts, and run scripts in the right order.</li>
<li>Easy to run in CI, to post markdown reports to your PRs.</li>
</ul>
<h2 id="demo"><a class="header" href="#demo"><label for="sql">Demo</label></a></h2>
<p>Feel free to try out Eugene by playing around with the SQL script
in the text area below. When you click the "Check" button, Eugene
will analyze the scripts and let you know if it found any issues.</p>
<div class="demo-area">
<form hx-post="https://api.kaveland.no/eugene/app/lint.html" 
      hx-target="#output"
      hx-on-htmx-response-error="check_for_413(event);">
<input type="hidden" name="sql" id="sql-input" value="">
<div id="sql" class="sql-playground">
-- You can use file markers like this to break migrations
-- into steps and run them in order.
-- file: create_table.sql
create table books (
    id serial primary key,
    title text,
    author text,
    published date
);
-- file: alter_table.sql
alter table books
  alter column title set not null;
alter table books
  alter column author set not null;
-- file: set_unique.sql
set local lock_timeout = '2s';
alter table books add constraint
  unique_title_author unique (title, author);
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.34.2/ace.js" integrity="sha512-WdJDvPkK4mLIW1kpkWRd7dFtAF6Z0xnfD3XbfrNsK2/f36vMNGt/44iqYQuliJZwCFw32CrxDRh2hpM2TJS1Ew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
var editor = ace.edit("sql", {
  mode: "ace/mode/sql",
  selectionStyle: "text",
  minLines: 20,
  maxLines: 40,
});
editor.resize();
document.getElementById('sql-input').value = editor.getValue();
editor.session.on('change', function() {
  document.getElementById('sql-input').value = editor.getValue();
  document.getElementById('hx-errors').innerHTML = '';
});
function check_for_413(event) {
  var statusText = event.detail.xhr.statusText;
  if (event.detail.xhr.status === 413) {
    document.getElementById('hx-errors').innerHTML = 
      '<div class="warning"><p>' + statusText + '</p><p>The SQL script is too large. Please try a smaller script.</p></div>';  
  } else {
    document.getElementById('hx-errors').innerHTML = 
      '<div class="warning"><p>' + statusText + '</p><p>Unable to lint script.</p></div>';
  }
}
</script>
<div>
<button class="float-right button-cta" id="random-example">Another Example</button> 
<button class="float-right button-cta" id="submit">Check</button>
<script>
function fetch_new_example(event) {
    event.preventDefault();
    fetch('https://api.kaveland.no/eugene/app/random.sql')
        .then(response => response.text())
        .then(data => {
              editor.setValue(data); 
              editor.clearSelection();
              document.getElementById('sql-input').value = data;
    });
}
document.getElementById("random-example").addEventListener("click", fetch_new_example);
</script>
</div>
</form>
<div id="hx-errors"></div>
<div id="output"></div>
</div>
<p>The demo corresponds to using <code>eugene lint</code> on a folder of SQL scripts
on your local machine. You can also use <code>eugene trace</code> to run the scripts,
which can pick up more issues, some of which <code>eugene lint</code> can't detect.</p>
<h2 id="installing-eugene"><a class="header" href="#installing-eugene">Installing eugene</a></h2>
<p>You can use <a href="https://mise.jdx.dev/">mise</a> with the <code>ubi</code> backend to install <code>eugene</code>:</p>
<pre><code class="language-shell">mise use ubi:kaaveland/eugene@latest
</code></pre>
<p>You can also install <code>eugene</code> using cargo, but this requires you to have rust
and some other build tools installed. To install rust, you can use
<a href="https://rustup.rs/">rustup</a>.</p>
<p>In addition to rust, you need:</p>
<ul>
<li><code>gcc</code> and <code>g++</code> <em>or</em> <code>clang</code> and <code>clang++</code>
<ul>
<li>on macos, you get these with <code>xcode-select --install</code></li>
<li>on ubuntu, install with <code>sudo apt install clang</code></li>
</ul>
</li>
<li><code>cmake</code>
<ul>
<li>on macos, you can get this with <code>brew install cmake</code></li>
<li>on ubuntu, you can get this with <code>sudo apt install cmake</code></li>
</ul>
</li>
</ul>
<p>After you have rust and the other build tools installed, you can install <code>eugene</code> with:</p>
<pre><code class="language-sh">cargo install eugene
</code></pre>
<p>It is also available as a Docker image:</p>
<pre><code class="language-sh">docker run --rm -v $(pwd):/workdir \
  ghcr.io/kaaveland/eugene:latest \
  lint /workdir
</code></pre>
<p>Eugene is available as a binary for Linux and macOS. You can download the latest release from
the <a href="https://github.com/kaaveland/eugene/releases">releases page</a>. Note that the binaries
are not notarized and signed for macOS, so you may need to allow the binary to run by
removing its quarantine attribute:</p>
<pre><code class="language-sh">xattr -d com.apple.quarantine eugene
</code></pre>
<h2 id="source-code-and-issue-tracker"><a class="header" href="#source-code-and-issue-tracker">Source code and issue tracker</a></h2>
<p>The source code is available on <a href="https://github.com/kaaveland/eugene/">GitHub</a>, where
it is also possible to report issues and suggest improvements.</p>
<p><code>eugene</code> is licensed under the MIT license.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Eugene has a number of subcommands, and can tell you about them:</p>
<pre><code class="language-shell">$ eugene help
eugene is a tool for writing safer schema changes for PostgreSQL

eugene can run your migration scripts and detect which locks that is taken by each
individual SQL statement and summarize which operations that conflict with those
locks, in other words what the script must wait for and what
concurrent transactions that would be blocked.


Usage: eugene [COMMAND]

Commands:
  lint         Lint SQL migration script by analyzing syntax tree
  trace        Trace effects by running statements from SQL migration script
  modes        List postgres lock modes
  explain      Explain what operations a lock mode allows and conflicts with
  hints        Show migration hints that eugene can detect in traces
  completions  Generate shell completions for eugene
  help         Print this message or the help of the given subcommand(s)

Options:
  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version
</code></pre>
<p>The two main subcommands are <a href="./lint.html"><code>eugene lint</code></a>
and <a href="./trace.html"><code>eugene trace</code></a>, which both have their own page.
<code>eugene lint</code> will perform syntax tree analysis of your SQL script
using the PostgreSQL parser, while <code>eugene trace</code> will actually run
it in a transaction and inspect the effects of the script on the
database. It will be easier to get started with <code>eugene lint</code> and
it can catch many dangerous patterns, but it may also report some
false positives and might not pick up everything that <code>eugene trace</code>
can catch.</p>
<h2 id="hints-provided-by-eugene"><a class="header" href="#hints-provided-by-eugene">Hints provided by eugene</a></h2>
<p>See <a href="./hints.html">hints</a> for a list of hints that Eugene can give you.</p>
<h2 id="blog"><a class="header" href="#blog">Blog</a></h2>
<p>I frequently blog about software development and other topics, here's
<a href="https://kaaveland.github.io/tags/eugene/">blog posts about egene</a>.</p>
<h2 id="release-notes"><a class="header" href="#release-notes">Release notes</a></h2>
<p>The <a href="https://github.com/kaaveland/eugene/releases">releases page</a> is
the best place to find release notes for <code>eugene</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next prefetch" href="lint.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next prefetch" href="lint.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
