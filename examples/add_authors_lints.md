# Eugene üîí lint report of `examples/add_authors.sql`

This is a human readable SQL script safety report generated by [eugene](https://github.com/kaaveland/eugene). Keep in mind that lints can be ignored by adding a `-- eugene: ignore E123` comment to the SQL statement or by passing --ignore E123 on the command line.

The migration script did not pass all the checks ‚ùå

## Statement number 1

### SQL

```sql
create table authors(id serial primary key, name text not null)
```

No checks matched for this statement. ‚úÖ

## Statement number 2

### SQL

```sql
alter table books alter column title set not null
```

### Lints

#### Validating table with a new `NOT NULL` column

ID: `E2`

A column was changed from `NULL` to `NOT NULL`. This blocks all table access until all rows are validated. A safer way is: Add a `CHECK` constraint as `NOT VALID`, validate it later, then make the column `NOT NULL`.

Statement takes `AccessExclusiveLock` on `public.books` by setting `title` to `NOT NULL` blocking reads until all rows are validated

#### Taking dangerous lock without timeout

ID: `E9`

A lock that would block many common operations was taken without a timeout. This can block all other operations on the table indefinitely if any other transaction holds a conflicting lock while `idle in transaction` or `active`. A safer way is: Run `SET LOCAL lock_timeout = '2s';` before the statement and retry the migration if necessary.

Statement takes lock on `public.books`, but does not set a lock timeout

## Statement number 3

### SQL

```sql
alter table books add column author_id integer not null
```

### Lints

#### Running more statements after taking `AccessExclusiveLock`

ID: `E4`

A transaction that holds an `AccessExclusiveLock` started a new statement. This blocks all access to the table for the duration of this statement. A safer way is: Run this statement in a new transaction.

Running more statements after taking `AccessExclusiveLock`

#### Taking dangerous lock without timeout

ID: `E9`

A lock that would block many common operations was taken without a timeout. This can block all other operations on the table indefinitely if any other transaction holds a conflicting lock while `idle in transaction` or `active`. A safer way is: Run `SET LOCAL lock_timeout = '2s';` before the statement and retry the migration if necessary.

Statement takes lock on `public.books`, but does not set a lock timeout

## Statement number 4

### SQL

```sql
alter table books add foreign key (author_id) references authors(id)
```

### Lints

#### Validating table with a new constraint

ID: `E1`

A new constraint was added and it is already `VALID`. This blocks all table access until all rows are validated. A safer way is: Add the constraint as `NOT VALID` and validate it with `ALTER TABLE ... VALIDATE CONSTRAINT` later.

Statement takes `AccessExclusiveLock` on `public.books`, blocking reads until constraint is validated

#### Running more statements after taking `AccessExclusiveLock`

ID: `E4`

A transaction that holds an `AccessExclusiveLock` started a new statement. This blocks all access to the table for the duration of this statement. A safer way is: Run this statement in a new transaction.

Running more statements after taking `AccessExclusiveLock`

#### Taking dangerous lock without timeout

ID: `E9`

A lock that would block many common operations was taken without a timeout. This can block all other operations on the table indefinitely if any other transaction holds a conflicting lock while `idle in transaction` or `active`. A safer way is: Run `SET LOCAL lock_timeout = '2s';` before the statement and retry the migration if necessary.

Statement takes lock on `public.books`, but does not set a lock timeout

## Statement number 5

### SQL

```sql
select * from books
```

### Lints

#### Running more statements after taking `AccessExclusiveLock`

ID: `E4`

A transaction that holds an `AccessExclusiveLock` started a new statement. This blocks all access to the table for the duration of this statement. A safer way is: Run this statement in a new transaction.

Running more statements after taking `AccessExclusiveLock`

