<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Eugene Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        <!-- Silly hack to fix non-loading assets at /eugene -->
        <script type="application/javascript">
            if (window.location.pathname === '/eugene') {
                window.location.pathname = '/eugene/';
            }
        </script>
        <!-- plausible.io is a privacy-friendly analytics, we want to count visitors to pages -->
        <script defer data-domain="kaveland.no" src="https://plausible.io/js/script.js"></script>
        <script src="https://unpkg.com/htmx.org@1.9.12"></script>
        

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/custom.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Eugene Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/kaaveland/eugene" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction-to-eugene"><a class="header" href="#introduction-to-eugene">Introduction to eugene</a></h1>
<p>Eugene helps you write zero downtime schema migration scripts for PostgreSQL databases.
Sometimes, the most straightforward way to make a change to your database schema is
also quite risky, due to locking issues and lock queues. Eugene has two modes that can
help you spot dangerous patterns and can suggest a safer way to achieve the same effect
in many cases, and it is easy to get started with both:</p>
<ul>
<li><code>eugene lint</code> will perform syntax tree analysis of your SQL script using the PostgreSQL parser.</li>
<li><code>eugene trace</code> run your scripts in a temporary PostgreSQL server, and inspect locks.</li>
<li>Both understand git and can easily check only what's new on your branch, commit or tag.</li>
<li>Both handle folders with version named scripts, and run scripts in the right order.</li>
<li>Easy to run in CI, to post markdown reports to your PRs.</li>
</ul>
<h2 id="demo"><a class="header" href="#demo"><label for="sql">Demo</label></a></h2>
<p>Feel free to try out Eugene by playing around with the SQL script
in the text area below. When you click the "Check" button, Eugene
will analyze the scripts and let you know if it found any issues.</p>
<div class="demo-area">
<form hx-post="https://api.kaveland.no/eugene/app/lint.html" 
      hx-target="#output"
      hx-on-htmx-response-error="check_for_413(event);">
<input type="hidden" name="sql" id="sql-input" value="">
<div id="sql" class="sql-playground">
-- You can use file markers like this to break migrations
-- into steps and run them in order.
-- file: create_table.sql
create table books (
    id serial primary key,
    title text,
    author text,
    published date
);
-- file: alter_table.sql
alter table books
  alter column title set not null;
alter table books
  alter column author set not null;
-- file: set_unique.sql
set local lock_timeout = '2s';
alter table books add constraint
  unique_title_author unique (title, author);
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.34.2/ace.js" integrity="sha512-WdJDvPkK4mLIW1kpkWRd7dFtAF6Z0xnfD3XbfrNsK2/f36vMNGt/44iqYQuliJZwCFw32CrxDRh2hpM2TJS1Ew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
var editor = ace.edit("sql", {
  mode: "ace/mode/sql",
  selectionStyle: "text",
  minLines: 20,
  maxLines: 40,
});
editor.resize();
document.getElementById('sql-input').value = editor.getValue();
editor.session.on('change', function() {
  document.getElementById('sql-input').value = editor.getValue();
  document.getElementById('hx-errors').innerHTML = '';
});
function check_for_413(event) {
  var statusText = event.detail.xhr.statusText;
  if (event.detail.xhr.status === 413) {
    document.getElementById('hx-errors').innerHTML = 
      '<div class="warning"><p>' + statusText + '</p><p>The SQL script is too large. Please try a smaller script.</p></div>';  
  } else {
    document.getElementById('hx-errors').innerHTML = 
      '<div class="warning"><p>' + statusText + '</p><p>Unable to lint script.</p></div>';
  }
}
</script>
<div>
<button class="float-right button-cta" id="random-example">Another Example</button> 
<button class="float-right button-cta" id="submit">Check</button>
<script>
function fetch_new_example(event) {
    event.preventDefault();
    fetch('https://api.kaveland.no/eugene/app/random.sql')
        .then(response => response.text())
        .then(data => {
              editor.setValue(data); 
              editor.clearSelection();
              document.getElementById('sql-input').value = data;
    });
}
document.getElementById("random-example").addEventListener("click", fetch_new_example);
</script>
</div>
</form>
<div id="hx-errors"></div>
<div id="output"></div>
</div>
<p>The demo corresponds to using <code>eugene lint</code> on a folder of SQL scripts
on your local machine. You can also use <code>eugene trace</code> to run the scripts,
which can pick up more issues, some of which <code>eugene lint</code> can't detect.</p>
<h2 id="installing-eugene"><a class="header" href="#installing-eugene">Installing eugene</a></h2>
<p>You can use <a href="https://mise.jdx.dev/">mise</a> with the <code>ubi</code> backend to install <code>eugene</code>:</p>
<pre><code class="language-shell">mise use ubi:kaaveland/eugene@latest
</code></pre>
<p>You can also install <code>eugene</code> using cargo, but this requires you to have rust
and some other build tools installed. To install rust, you can use
<a href="https://rustup.rs/">rustup</a>.</p>
<p>In addition to rust, you need:</p>
<ul>
<li><code>gcc</code> and <code>g++</code> <em>or</em> <code>clang</code> and <code>clang++</code>
<ul>
<li>on macos, you get these with <code>xcode-select --install</code></li>
<li>on ubuntu, install with <code>sudo apt install clang</code></li>
</ul>
</li>
<li><code>cmake</code>
<ul>
<li>on macos, you can get this with <code>brew install cmake</code></li>
<li>on ubuntu, you can get this with <code>sudo apt install cmake</code></li>
</ul>
</li>
</ul>
<p>After you have rust and the other build tools installed, you can install <code>eugene</code> with:</p>
<pre><code class="language-sh">cargo install eugene
</code></pre>
<p>It is also available as a Docker image:</p>
<pre><code class="language-sh">docker run --rm -v $(pwd):/workdir \
  ghcr.io/kaaveland/eugene:latest \
  lint /workdir
</code></pre>
<p>Eugene is available as a binary for Linux and macOS. You can download the latest release from
the <a href="https://github.com/kaaveland/eugene/releases">releases page</a>. Note that the binaries
are not notarized and signed for macOS, so you may need to allow the binary to run by
removing its quarantine attribute:</p>
<pre><code class="language-sh">xattr -d com.apple.quarantine eugene
</code></pre>
<h2 id="source-code-and-issue-tracker"><a class="header" href="#source-code-and-issue-tracker">Source code and issue tracker</a></h2>
<p>The source code is available on <a href="https://github.com/kaaveland/eugene/">GitHub</a>, where
it is also possible to report issues and suggest improvements.</p>
<p><code>eugene</code> is licensed under the MIT license.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Eugene has a number of subcommands, and can tell you about them:</p>
<pre><code class="language-shell">$ eugene help
eugene is a tool for writing safer schema changes for PostgreSQL

eugene can run your migration scripts and detect which locks that is taken by each
individual SQL statement and summarize which operations that conflict with those
locks, in other words what the script must wait for and what
concurrent transactions that would be blocked.


Usage: eugene [COMMAND]

Commands:
  lint         Lint SQL migration script by analyzing syntax tree
  trace        Trace effects by running statements from SQL migration script
  modes        List postgres lock modes
  explain      Explain what operations a lock mode allows and conflicts with
  hints        Show migration hints that eugene can detect in traces
  completions  Generate shell completions for eugene
  help         Print this message or the help of the given subcommand(s)

Options:
  -h, --help
          Print help (see a summary with '-h')

  -V, --version
          Print version
</code></pre>
<p>The two main subcommands are <a href="./lint.html"><code>eugene lint</code></a>
and <a href="./trace.html"><code>eugene trace</code></a>, which both have their own page.
<code>eugene lint</code> will perform syntax tree analysis of your SQL script
using the PostgreSQL parser, while <code>eugene trace</code> will actually run
it in a transaction and inspect the effects of the script on the
database. It will be easier to get started with <code>eugene lint</code> and
it can catch many dangerous patterns, but it may also report some
false positives and might not pick up everything that <code>eugene trace</code>
can catch.</p>
<h2 id="hints-provided-by-eugene"><a class="header" href="#hints-provided-by-eugene">Hints provided by eugene</a></h2>
<p>See <a href="./hints.html">hints</a> for a list of hints that Eugene can give you.</p>
<h2 id="blog"><a class="header" href="#blog">Blog</a></h2>
<p>I frequently blog about software development and other topics, here's
<a href="https://kaaveland.github.io/tags/eugene/">blog posts about egene</a>.</p>
<h2 id="release-notes"><a class="header" href="#release-notes">Release notes</a></h2>
<p>The <a href="https://github.com/kaaveland/eugene/releases">releases page</a> is
the best place to find release notes for <code>eugene</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eugene-lint"><a class="header" href="#eugene-lint">eugene lint</a></h1>
<p>The <code>eugene lint</code> command will analyze the syntax tree of a SQL script and spot a number
of dangerous patterns. It works by using the
<a href="https://github.com/pganalyze/pg_query.rs"><code>pg_query.rs</code></a> library to parse SQL scripts
using the same parser that PostgreSQL uses internally. This allows Eugene to work with
the same kind of syntax trees that the server uses.</p>
<p><code>eugene lint</code> will attempt to keep track of whether objects are new in the same transaction,
so that it can avoid false positives for tables that aren't visible to other transactions yet.
In some cases, it will report false positives, since it can't know the DDL of the tables that
are being referenced. For example, it can't know if a type change is safe. It is easy to
ignore these false positives by adding a comment to the SQL script, see
<a href="ignores.html">ignores</a>.</p>
<p><code>eugene lint</code> can catch many things that it is specifically designed to catch, but it must
have reasonably precise rules. Some SQL statements will implicitly create indexes, which
will prevent writes to the table, and <code>eugene lint</code> will catch those that it knows about,
but there may be some ways for this to happen that it doesn't know about.</p>
<p>If you want to run <code>eugene lint</code> in CI, or as a pre-commit hook, you can use <code>--git-diff=main</code>
or <code>-gmain</code> to lint files that are new/unstaged, or have changes in them since <code>main</code>.</p>
<h2 id="usage-1"><a class="header" href="#usage-1">Usage</a></h2>
<pre><code class="language-shell">$ eugene help lint
Lint SQL migration script by analyzing syntax tree

`eugene lint` exits with failure if any lint is detected.

Usage: eugene lint [OPTIONS] [paths]...

Arguments:
  [paths]...
          Path to SQL migration scripts, directories, or '-' to read from stdin

Options:
  -v, --var &lt;PLACEHOLDERS&gt;
          Provide name=value for replacing ${name} with value in the SQL script
          
          Can be used multiple times to provide more placeholders.

  -i, --ignore &lt;IGNORED_HINTS&gt;
          Ignore the hints with these IDs, use `eugene hints` to see available hints
          
          Can be used multiple times: `-i E3 -i E4`
          
          Or comment your SQL statement like this:
          
          `-- eugene-ignore: E3, E4`
          
          alter table foo add column bar json;
          
          This will ignore hints E3 and E4 for this statement only.

  -f, --format &lt;FORMAT&gt;
          Output format, plain, json or markdown
          
          [default: plain]
          [possible values: json, markdown, md, plain]

  -a, --accept-failures
          Exit successfully even if problems are detected.
          
          Will still fail for syntax errors in the SQL script.

      --sort-mode &lt;SORT_MODE&gt;
          Sort mode for script discovery, auto, name or none
          
          This is used to order scripts when a path is a directory, or many paths are provided.
          
          `auto` will sort by versions or sequence numbers.
          
          `auto` requires all files to have the same naming scheme, either flyway-style or leading sequence numbers.
          
          `name` will sort lexically by name.
          
          [default: auto]
          [possible values: auto, name, none]

  -s, --skip-summary
          Skip the summary section for markdown output

  -g, --git-diff &lt;GIT_DIFF&gt;
          Filter out discovered scripts that are have not been changed since this git ref
          
          Pass a git ref, like a commit hash, tag, or branch name.

      --skip &lt;SKIP&gt;
          Skip SQL statements matching this regex (do not execute or lint them)
          
          For example:
          
          eugene trace --skip '.*flyway.*' --skip '.*moreToSkip.*'
          
          See https://docs.rs/regex/latest/regex/#syntax

  -h, --help
          Print help (see a summary with '-h')
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eugene-trace"><a class="header" href="#eugene-trace">eugene trace</a></h1>
<p>The <code>eugene trace</code> command will actually execute your SQL script in a transaction. If you have
PostgreSQL installed, <code>eugene trace</code> can set up a temporary database server for you, and run
through all the SQL scripts you give it to trace them. If you prefer to use your own database
server, you can give provide <code>eugene trace</code> with connection information and it will roll back
scripts by default, in this case.</p>
<p>PostgreSQL has a number of interesting features that can help <code>eugene trace</code> look for dangerous
patterns while executing SQL statements in a transaction. <code>eugene trace</code> will look at the data
types of every column, it will discover new indexes and constraints, and it will discover when
database objects get moved to a new location on disk -- that is, table or index rewrites.</p>
<p>Since <code>eugene trace</code> has so much information, it is much less likely to trigger false positives
than <code>eugene lint</code>, but it is also slower and requires a live database connection.</p>
<p><code>eugene trace</code> can catch broad categories of dangerous patterns -- sometimes, it will discover
a table rewrite that <code>eugene lint</code> can not detect, but it may not be able to tell you about
why that table rewrite happened. <code>eugene trace</code> will discover all indexes and constraints
created in a transaction, even if they were implicitly created. If you need to tell
<code>eugene trace</code> that you know a statement to be safe, you can tell it to ignore a lint by
adding a comment to your SQL script, see <a href="ignores.html">ignores</a>.</p>
<p>If you want to run <code>eugene trace</code> in CI, or as a pre-commit hook, you can use <code>--git-diff=main</code>
or <code>-gmain</code> to trace files that are new/unstaged, or have changes in them since <code>main</code>.
<code>eugene trace</code> will still run all the scripts, but will only check the ones that have changed.</p>
<h2 id="usage-2"><a class="header" href="#usage-2">Usage</a></h2>
<pre><code class="language-shell">$ eugene help trace
Trace effects by running statements from SQL migration script

`eugene trace` will set up a temporary postgres server for tracing, unless disabled.

Reads $PGPASS for password to postgres, if ~/.pgpass is not found.

`eugene trace` exits with failure if any problems are detected.

Usage: eugene trace [OPTIONS] [paths]...

Arguments:
  [paths]...
          Path to SQL migration scripts, directories, or '-' to read from stdin

Options:
  -v, --var &lt;PLACEHOLDERS&gt;
          Provide name=value for replacing ${name} with value in the SQL script
          
          Can be used multiple times to provide more placeholders.

  -i, --ignore &lt;IGNORED_HINTS&gt;
          Ignore the hints with these IDs, use `eugene hints` to see available hints
          
          Can be used multiple times: `-i E3 -i E4`
          
          Or comment your SQL statement like this:
          
          `-- eugene-ignore: E3, E4`
          
          alter table foo add column bar json;
          
          This will ignore hints E3 and E4 for this statement only.

  -f, --format &lt;FORMAT&gt;
          Output format, plain, json or markdown
          
          [default: plain]
          [possible values: json, markdown, md, plain]

  -a, --accept-failures
          Exit successfully even if problems are detected.
          
          Will still fail for syntax errors in the SQL script.

      --sort-mode &lt;SORT_MODE&gt;
          Sort mode for script discovery, auto, name or none
          
          This is used to order scripts when a path is a directory, or many paths are provided.
          
          `auto` will sort by versions or sequence numbers.
          
          `auto` requires all files to have the same naming scheme, either flyway-style or leading sequence numbers.
          
          `name` will sort lexically by name.
          
          [default: auto]
          [possible values: auto, name, none]

  -s, --skip-summary
          Skip the summary section for markdown output

  -g, --git-diff &lt;GIT_DIFF&gt;
          Filter out discovered scripts that are have not been changed since this git ref
          
          Pass a git ref, like a commit hash, tag, or branch name.

      --skip &lt;SKIP&gt;
          Skip SQL statements matching this regex (do not execute or lint them)
          
          For example:
          
          eugene trace --skip '.*flyway.*' --skip '.*moreToSkip.*'
          
          See https://docs.rs/regex/latest/regex/#syntax

      --disable-temporary
          Disable creation of temporary postgres server for tracing
          
          By default, trace will create a postgres server in a temporary directory
          
          This relies on having `initdb` and `pg_ctl` in PATH, which eugene images have.
          
          Eugene deletes the temporary database cluster when done tracing.

  -o, --postgres-options &lt;POSTGRES_OPTIONS&gt;
          Portgres options to pass to the temporary postgres server
          
          Example: `eugene trace -o "-c fsync=off -c log_statement=all"`
          
          [default: ]

      --initdb &lt;INITDB_OPTIONS&gt;
          Initdb options to pass when creating the temporary postgres server
          
          Example: `eugene trace --initdb "--encoding=UTF8"`
          
          Supply it more than once to add multiple options.

  -U, --user &lt;USER&gt;
          Username to use for connecting to postgres
          
          [default: postgres]

  -d, --database &lt;DATABASE&gt;
          Database to connect to
          
          [default: postgres]

  -H, --host &lt;HOST&gt;
          Host to connect to
          
          [default: localhost]

  -p, --port &lt;PORT&gt;
          Port to connect to
          
          [default: 5432]

  -c, --commit
          Commit at the end of the transaction.
          
          Commit is always enabled for the temporary server, otherwise rollback is default.

  -e, --extra
          Show locks that are normally not in conflict with application code

  -h, --help
          Print help (see a summary with '-h')
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ignoring-rules"><a class="header" href="#ignoring-rules">Ignoring rules</a></h1>
<p>Both <code>eugene lint</code> and <code>eugene trace</code> can be instructed to ignore rules, so that
false positives can be suppressed, or warnings that aren't relevant for your use case
can be hidden.</p>
<p>You can ignore specific rule IDs for an entire transaction, using the command line flag:</p>
<pre><code class="language-shell">eugene lint --ignore E2 my_script.sql
eugene trace --ignore E2 my_script.sql
</code></pre>
<p>You can ignore all rule IDs for a single statement:</p>
<pre><code class="language-sql">-- eugene: ignore
alter table books alter column title set not null;
</code></pre>
<p>You can ignore specific rule IDs for a single statement:</p>
<pre><code class="language-sql">-- eugene: ignore E2, E3
alter table books alter column title set not null;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eugene-web"><a class="header" href="#eugene-web">eugene web</a></h1>
<p>Eugene has a tiny web API that can be used to lint SQL scripts. This API exposes
some functionality for demo purposes only. It's running with very limited
resources, so please be kind to it.</p>
<p>It is written using <a href="https://crates.io/crates/axum">axum</a>, mostly to learn
something about how to write web APIs in Rust. You can check out the code
in the <a href="https://github.com/kaaveland/eugene/tree/main/eugene-web">eugene-web</a>
crate in the eugene repository.</p>
<h2 id="endpoints"><a class="header" href="#endpoints">Endpoints</a></h2>
<p>All the endpoints are relative to <code>https://api.kaveland.no/eugene/app</code> or
<code>http://localhost:3000/eugene/app</code> if you're running it locally.</p>
<h3 id="post-linthtml"><a class="header" href="#post-linthtml"><code>POST /lint.html</code></a></h3>
<p>This endpoint accepts a form with a parameter named <code>sql</code> that contains
one or more SQL scripts preceeded by a <code>-- name.sql</code> marker. Each script
can contain multiple statements. The API returns html. This endpoint is
used by the form in the <a href="introduction.html">introduction</a> page.</p>
<h3 id="post-lintraw"><a class="header" href="#post-lintraw"><code>POST /lint.raw</code></a></h3>
<p>This endpoint accepts a SQL script in the body and responds with a plain text
response. It's suitable for use with <code>curl</code> from the terminal, you can check a
file named <code>dmo.sql</code> like this:</p>
<pre><code class="language-shell">curl -XPOST -d @dmo.sql https://api.kaveland.no/eugene/app/lint.raw
unnamed:1 E2 Validating table with a new `NOT NULL` column https://kaveland.no/eugene/hints/E2/
unnamed:1 E9 Taking dangerous lock without timeout https://kaveland.no/eugene/hints/E9/
unnamed:2 E2 Validating table with a new `NOT NULL` column https://kaveland.no/eugene/hints/E2/
unnamed:2 E4 Running more statements after taking `AccessExclusiveLock` https://kaveland.no/eugene/hints/E4/
unnamed:2 E9 Taking dangerous lock without timeout https://kaveland.no/eugene/hints/E9/
unnamed:2 W12 Multiple `ALTER TABLE` statements where one will do https://kaveland.no/eugene/hints/W12/
</code></pre>
<h3 id="post-lintjson"><a class="header" href="#post-lintjson"><code>POST /lint.json</code></a></h3>
<p>This endpoint accepts a json body:</p>
<pre><code class="language-json">{
  "sql": "-- name.sql\ncreate table books (id serial primary key);"
}
</code></pre>
<p>The <code>sql</code> member is a single SQL script. It responds with a json object that
contains the results, suitable to use for rendering templates or something.</p>
<pre><code>{
  "name": "dmo.sql",
  "passed_all_checks": false,
  "skip_summary": false  
  "statements": [
    {
      "statement_number": 1,
      "line_number": 1,
      "sql": "alter table books\n  alter column text set not null",
      "triggered_rules": [
        {
          "id": "E2",
          "name": "Validating table with a new `NOT NULL` column",
          "condition": "A column was changed from `NULL` to `NOT NULL`",
...          
</code></pre>
<h3 id="usage-3"><a class="header" href="#usage-3">Usage</a></h3>
<p>If you find yourself using the API a lot, please consider installing <code>eugene</code> locally instead.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-in-github-actions"><a class="header" href="#running-in-github-actions">Running in GitHub Actions</a></h1>
<p>With the <code>--git-diff</code> option, it is easy to set up eugene to run in a GitHub Actions workflow.
Below are some example jobs that you copy to your github workflows. There are 4 different jobs
configured:</p>
<ul>
<li><code>trace</code> will run <code>eugene trace</code> on the files that have changed since <code>main</code> and stop the build
if it finds any issues.</li>
<li><code>lint</code> will run <code>eugene lint</code> on the files that have changed since <code>main</code> and stop the build
if it finds any issues.</li>
<li><code>post_trace</code> will run <code>eugene trace</code> on the files that have changed since <code>main</code> and post the
results as a markdown comment on the pull request, but allow the build to pass even if issues
are found.</li>
<li><code>post_lint</code> will run <code>eugene lint</code> on the files that have changed since <code>main</code> and post the
results as a markdown comment on the pull request, but allow the build to pass even if issues
are found.</li>
</ul>
<pre><code class="language-yaml">name: Eugene CI check
on:
  pull_request:
    branches:
      - main
env:
  EUGENE_VERSION: "0.6.2"

permissions:
  contents: read
  pull-requests: write

jobs:
  trace:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    - name: Download eugene
      run: |
        curl -L  https://github.com/kaaveland/eugene/releases/download/$EUGENE_VERSION/eugene-x86_64-unknown-linux-musl -o eugene
        chmod +x eugene
    - name: Put postgres binaries on PATH for eugene
      run: echo "/usr/lib/postgresql/14/bin" &gt;&gt; $GITHUB_PATH
    - name: Trace
      run: ./eugene trace --git-diff origin/main migration-scripts

  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Download eugene
        run: |
          curl -L  https://github.com/kaaveland/eugene/releases/download/$EUGENE_VERSION/eugene-x86_64-unknown-linux-musl -o eugene
          chmod +x eugene
      - name: Lint files
        run: ./eugene lint --git-diff origin/main migration-scripts

  post_trace:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Download eugene
        run: |
          curl -L  https://github.com/kaaveland/eugene/releases/download/$EUGENE_VERSION/eugene-x86_64-unknown-linux-musl -o eugene
          chmod +x eugene
      - name: Put postgres binaries on PATH for eugene
        run: echo "/usr/lib/postgresql/14/bin" &gt;&gt; $GITHUB_PATH
      - name: Trace files
        run: ./eugene trace --git-diff origin/main migration-scripts -f md --accept-failures &gt; trace.md
      - name: Post Comment
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          COMMENT=$(cat trace.md)
          gh pr comment ${{ github.event.pull_request.number }} --body "$COMMENT"

  post_lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: actions/checkout@v4
      - name: Download eugene
        run: |
          curl -L  https://github.com/kaaveland/eugene/releases/download/$EUGENE_VERSION/eugene-x86_64-unknown-linux-musl -o eugene
          chmod +x eugene
      - name: Lint files
        run: ./eugene lint --git-diff origin/main migration-scripts -f md --accept-failures &gt; lint.md
      - name: Post Comment
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          COMMENT=$(cat lint.md)
          gh pr comment ${{ github.event.pull_request.number }} --body "$COMMENT"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-in-gitlab-ci"><a class="header" href="#running-in-gitlab-ci">Running in GitLab CI</a></h1>
<p>With the <code>--git-diff</code> option, it is easy to set up eugene to run in a GitLab CI/CD pipeline.
Below are some example jobs that you can copy into your <code>.gitlab-ci.yml</code> file.</p>
<p>There are 6 different jobs configured:</p>
<ul>
<li><code>lint</code> will run <code>eugene lint</code> on the files that have changed since <code>main</code> and stop the build if it finds any issues.</li>
<li><code>trace</code> will run <code>eugene trace</code> on the files that have changed since <code>main</code> and stop the build if it finds any issues.</li>
<li><code>trace_report</code> and <code>comment_trace</code> will run <code>eugene trace</code> on the files that have changed since <code>main</code> and post the
results as a markdown comment on the merge request, but allow the build to pass even if issues are found.</li>
<li><code>lint_report</code> and <code>comment_lint</code> will run <code>eugene lint</code> on the files that have changed since <code>main</code> and post the
results as a markdown comment on the merge request, but allow the build to pass even if issues are found.</li>
</ul>
<p>Note that for <code>comment_trace</code> and <code>comment_lint</code> to work, <code>GITLAB_TOKEN</code> must be set in
CI/CD Variables in the GitLab project settings. It should be a token that has access
to the project, so that it can post comments on merge requests.</p>
<pre><code class="language-yaml">.eugene_rules:
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'

.eugene:
  extends: .eugene_rules
  before_script:
    - git config --global --add safe.directory $CI_PROJECT_DIR
    - git fetch --depth=1 origin main
  image:
    name: ghcr.io/kaaveland/eugene:latest
    entrypoint: ["/bin/sh", "-c"]

lint:
  extends: .eugene
  script: eugene lint --git-diff origin/main migration-scripts

trace:
  extends: .eugene
  script: eugene trace --git-diff origin/main migration-scripts

trace_report:
    extends: .eugene
    script: eugene trace --git-diff origin/main migration-scripts -f md --accept-failures &gt; trace.md
    artifacts:
      paths:
        - trace.md

comment_trace:
  extends: .eugene_rules
  image:
    name: registry.gitlab.com/gitlab-org/cli
    entrypoint: [ "/bin/sh", "-c" ]
  needs:
    - trace_report
  script:
    - body=$(cat trace.md)
    - glab mr note $CI_MERGE_REQUEST_IID --unique -m "$body"

lint_report:
  extends: .eugene
  script: eugene lint --git-diff origin/main migration-scripts -f md --accept-failures &gt; lint.md
  rules:
    - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
  artifacts:
    paths:
      - lint.md

comment_lint:
  extends: .eugene_rules
  image:
    name: registry.gitlab.com/gitlab-org/cli
    entrypoint: ["/bin/sh", "-c"]
  needs:
    - lint_report
  script:
    - body=$(cat lint.md)
    - glab mr note $CI_MERGE_REQUEST_IID --unique -m "$body"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="eugene-rules"><a class="header" href="#eugene-rules">eugene rules</a></h1>
<p>This section contains a list of hints that eugene recognizes, whether they
are supported by <code>eugene lint</code>, <code>eugene trace</code>, or both, and what you can
do to avoid the dangerous pattern.</p>
<p>These are all automatically generated from templates during the build of
<code>eugene</code> so when new hints are added, the documentation will be updated
automatically.</p>
<p>Each chapter refers to a specific <strong>rule</strong> in the <code>eugene</code> codebase. The
rule is identified by an ID that can be passed to <code>eugene</code>, as well as a
name. The documentation describes what <code>eugene</code> looks for when triggering
the rule, what effect the schema change may have on the database and
concurrent transactions, and if there is a workaround. The documentation
will tell you whether one or both of <code>eugene lint</code> and <code>eugene trace</code>
that can detect the condition the rule describes.</p>
<p>Each rule page will link to some eugene example reports for the migration
pattern it describes, so you can see what the output looks like.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e1-validating-table-with-a-new-constraint"><a class="header" href="#e1-validating-table-with-a-new-constraint"><code>E1</code> Validating table with a new constraint</a></h1>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p><strong>Triggered when</strong>: A new constraint was added and it is already <code>VALID</code>.</p>
<p><strong>Effect</strong>: This blocks all table access until all rows are validated.</p>
<p><strong>Workaround</strong>: Add the constraint as <code>NOT VALID</code> and validate it with <code>ALTER TABLE ... VALIDATE CONSTRAINT</code> later.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration"><a class="header" href="#problematic-migration">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    add constraint name_not_null
        check (name is not null);
</code></pre>
<h2 id="safer-migration"><a class="header" href="#safer-migration">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    add constraint name_not_null
        check (name is not null) not valid;

-- 3.sql
set local lock_timeout = '2s';
alter table authors
    validate constraint name_not_null;
</code></pre>
<h2 id="eugene-report-examples"><a class="header" href="#eugene-report-examples">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E1/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E1/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E1/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E1/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e2-validating-table-with-a-new-not-null-column"><a class="header" href="#e2-validating-table-with-a-new-not-null-column"><code>E2</code> Validating table with a new <code>NOT NULL</code> column</a></h1>
<h2 id="description-1"><a class="header" href="#description-1">Description</a></h2>
<p><strong>Triggered when</strong>: A column was changed from <code>NULL</code> to <code>NOT NULL</code>.</p>
<p><strong>Effect</strong>: This blocks all table access until all rows are validated.</p>
<p><strong>Workaround</strong>: Add a <code>CHECK</code> constraint as <code>NOT VALID</code>, validate it later, then make the column <code>NOT NULL</code>.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration-1"><a class="header" href="#problematic-migration-1">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    alter column name set not null;
</code></pre>
<h2 id="safer-migration-1"><a class="header" href="#safer-migration-1">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    add constraint check_name_not_null
        check (name is not null) not valid;

-- 3.sql
set local lock_timeout = '2s';
alter table authors
    validate constraint check_name_not_null;

-- 4.sql
set local lock_timeout = '2s';
-- eugene trace knows name has a valid not null check, but eugene lint doesn't
-- eugene: ignore E2
alter table authors
    alter name set not null;
</code></pre>
<h2 id="eugene-report-examples-1"><a class="header" href="#eugene-report-examples-1">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E2/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E2/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E2/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E2/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e3-add-a-new-json-column"><a class="header" href="#e3-add-a-new-json-column"><code>E3</code> Add a new JSON column</a></h1>
<h2 id="description-2"><a class="header" href="#description-2">Description</a></h2>
<p><strong>Triggered when</strong>: A new column of type <code>json</code> was added to a table.</p>
<p><strong>Effect</strong>: This breaks <code>SELECT DISTINCT</code> queries or other operations that need equality checks on the column.</p>
<p><strong>Workaround</strong>: Use the <code>jsonb</code> type instead, it supports all use-cases of <code>json</code> and is more robust and compact.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration-2"><a class="header" href="#problematic-migration-2">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null,
    meta json
);
</code></pre>
<h2 id="safer-migration-2"><a class="header" href="#safer-migration-2">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null,
    meta jsonb
);
</code></pre>
<h2 id="eugene-report-examples-2"><a class="header" href="#eugene-report-examples-2">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E3/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E3/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E3/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E3/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e4-running-more-statements-after-taking-accessexclusivelock"><a class="header" href="#e4-running-more-statements-after-taking-accessexclusivelock"><code>E4</code> Running more statements after taking <code>AccessExclusiveLock</code></a></h1>
<h2 id="description-3"><a class="header" href="#description-3">Description</a></h2>
<p><strong>Triggered when</strong>: A transaction that holds an <code>AccessExclusiveLock</code> started a new statement.</p>
<p><strong>Effect</strong>: This blocks all access to the table for the duration of this statement.</p>
<p><strong>Workaround</strong>: Run this statement in a new transaction.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration-3"><a class="header" href="#problematic-migration-3">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    add column email text not null;
select count(*) from authors;
</code></pre>
<h2 id="safer-migration-3"><a class="header" href="#safer-migration-3">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    add column email text not null;

-- 3.sql
select count(*) from authors;
</code></pre>
<h2 id="eugene-report-examples-3"><a class="header" href="#eugene-report-examples-3">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E4/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E4/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E4/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E4/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e5-type-change-requiring-table-rewrite"><a class="header" href="#e5-type-change-requiring-table-rewrite"><code>E5</code> Type change requiring table rewrite</a></h1>
<h2 id="description-4"><a class="header" href="#description-4">Description</a></h2>
<p><strong>Triggered when</strong>: A column was changed to a data type that isn't binary compatible.</p>
<p><strong>Effect</strong>: This causes a full table rewrite while holding a lock that prevents all other use of the table.</p>
<p><strong>Workaround</strong>: Add a new column, update it in batches, and drop the old column.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration-4"><a class="header" href="#problematic-migration-4">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table prices
    alter price set data type bigint;
</code></pre>
<h2 id="safer-migration-4"><a class="header" href="#safer-migration-4">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table prices
    add column new_price bigint;

-- 3.sql
update prices set new_price = price :: bigint;
set local lock_timeout = '2s';
alter table prices
    add constraint check_new_price_not_null
        check (new_price is not null) not valid;

-- 4.sql
set local lock_timeout = '2s';
alter table prices
    validate constraint check_new_price_not_null,
    drop column price;
-- eugene: ignore E4
-- this has to run in the same transaction as dropping the old price column
alter table prices
    rename column new_price to price;
</code></pre>
<h2 id="eugene-report-examples-4"><a class="header" href="#eugene-report-examples-4">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E5/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E5/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E5/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E5/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e6-creating-a-new-index-on-an-existing-table"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table"><code>E6</code> Creating a new index on an existing table</a></h1>
<h2 id="description-5"><a class="header" href="#description-5">Description</a></h2>
<p><strong>Triggered when</strong>: A new index was created on an existing table without the <code>CONCURRENTLY</code> keyword.</p>
<p><strong>Effect</strong>: This blocks all writes to the table while the index is being created.</p>
<p><strong>Workaround</strong>: Run <code>CREATE INDEX CONCURRENTLY</code> instead of <code>CREATE INDEX</code>.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration-5"><a class="header" href="#problematic-migration-5">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
set local lock_timeout = '2s';
create index
    authors_name_idx on authors (name);
</code></pre>
<h2 id="safer-migration-5"><a class="header" href="#safer-migration-5">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
create index concurrently
    authors_name_idx on authors (name);
</code></pre>
<h2 id="eugene-report-examples-5"><a class="header" href="#eugene-report-examples-5">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E6/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E6/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E6/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E6/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e7-creating-a-new-unique-constraint"><a class="header" href="#e7-creating-a-new-unique-constraint"><code>E7</code> Creating a new unique constraint</a></h1>
<h2 id="description-6"><a class="header" href="#description-6">Description</a></h2>
<p><strong>Triggered when</strong>: Adding a new unique constraint implicitly creates index.</p>
<p><strong>Effect</strong>: This blocks all writes to the table while the index is being created and validated.</p>
<p><strong>Workaround</strong>: <code>CREATE UNIQUE INDEX CONCURRENTLY</code>, then add the constraint using the index.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration-6"><a class="header" href="#problematic-migration-6">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    add constraint unique_name unique(name);
</code></pre>
<h2 id="safer-migration-6"><a class="header" href="#safer-migration-6">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
create unique index concurrently
    authors_name_unique on authors(name);

-- 3.sql
set local lock_timeout = '2s';
alter table authors
    add constraint unique_name
        unique using index authors_name_unique;
</code></pre>
<h2 id="eugene-report-examples-6"><a class="header" href="#eugene-report-examples-6">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E7/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E7/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E7/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E7/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e8-creating-a-new-exclusion-constraint"><a class="header" href="#e8-creating-a-new-exclusion-constraint"><code>E8</code> Creating a new exclusion constraint</a></h1>
<h2 id="description-7"><a class="header" href="#description-7">Description</a></h2>
<p><strong>Triggered when</strong>: Found a new exclusion constraint.</p>
<p><strong>Effect</strong>: This blocks all reads and writes to the table while the constraint index is being created.</p>
<p><strong>Workaround</strong>: There is no safe way to add an exclusion constraint to an existing table.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration-7"><a class="header" href="#problematic-migration-7">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    add constraint authors_name_excl
        exclude (name with =);
</code></pre>
<h2 id="safer-migration-7"><a class="header" href="#safer-migration-7">Safer migration</a></h2>
<p>Currently, we don't know of a safe way to avoid this issue.</p>
<p>Report an issue at the <a href="https://github.com/kaaveland/eugene">tracker</a> if
you know a way!</p>
<h2 id="eugene-report-examples-7"><a class="header" href="#eugene-report-examples-7">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E8/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E8/unsafe_trace.html">Problem traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e9-taking-dangerous-lock-without-timeout"><a class="header" href="#e9-taking-dangerous-lock-without-timeout"><code>E9</code> Taking dangerous lock without timeout</a></h1>
<h2 id="description-8"><a class="header" href="#description-8">Description</a></h2>
<p><strong>Triggered when</strong>: A lock that would block many common operations was taken without a timeout.</p>
<p><strong>Effect</strong>: This can block all other operations on the table indefinitely if any other transaction holds a conflicting lock while <code>idle in transaction</code> or <code>active</code>.</p>
<p><strong>Workaround</strong>: Run <code>SET LOCAL lock_timeout = '2s';</code> before the statement and retry the migration if necessary.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code> and <code>eugene trace</code></p>
<h2 id="problematic-migration-8"><a class="header" href="#problematic-migration-8">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
alter table authors add column email text;
</code></pre>
<h2 id="safer-migration-8"><a class="header" href="#safer-migration-8">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors add column email text;
</code></pre>
<h2 id="eugene-report-examples-8"><a class="header" href="#eugene-report-examples-8">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E9/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E9/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E9/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E9/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e10-rewrote-table-or-index-while-holding-dangerous-lock"><a class="header" href="#e10-rewrote-table-or-index-while-holding-dangerous-lock"><code>E10</code> Rewrote table or index while holding dangerous lock</a></h1>
<h2 id="description-9"><a class="header" href="#description-9">Description</a></h2>
<p><strong>Triggered when</strong>: A table or index was rewritten while holding a lock that blocks many operations.</p>
<p><strong>Effect</strong>: This blocks many operations on the table or index while the rewrite is in progress.</p>
<p><strong>Workaround</strong>: Build a new table or index, write to both, then swap them.</p>
<p><strong>Detected by</strong>: <code>eugene trace</code></p>
<h2 id="problematic-migration-9"><a class="header" href="#problematic-migration-9">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
);

create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors add column meta jsonb;

-- eugene: ignore E5, E4
-- causes table rewrite, but this example isnt't about that
alter table prices
    alter price set data type bigint;
</code></pre>
<h2 id="safer-migration-9"><a class="header" href="#safer-migration-9">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
);

create table authors (
    id integer generated always as identity
        primary key,
    name text not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table authors
    add column meta jsonb;

-- 3.sql
set local lock_timeout = '2s';
-- eugene: ignore E5, E4
-- causes table rewrite, but this example isnt't about that
alter table prices
    alter price set data type bigint;
</code></pre>
<h2 id="eugene-report-examples-9"><a class="header" href="#eugene-report-examples-9">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E10/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E10/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E10/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E10/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e11-adding-a-serial-or-generated--stored-column"><a class="header" href="#e11-adding-a-serial-or-generated--stored-column"><code>E11</code> Adding a <code>SERIAL</code> or <code>GENERATED ... STORED</code> column</a></h1>
<h2 id="description-10"><a class="header" href="#description-10">Description</a></h2>
<p><strong>Triggered when</strong>: A new column was added with a <code>SERIAL</code> or <code>GENERATED</code> type.</p>
<p><strong>Effect</strong>: This blocks all table access until the table is rewritten.</p>
<p><strong>Workaround</strong>: Can not be done without a table rewrite.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code></p>
<h2 id="problematic-migration-10"><a class="header" href="#problematic-migration-10">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table prices (
    price int not null
);

-- 2.sql
set local lock_timeout = '2s';
alter table prices
    add column id serial;
</code></pre>
<h2 id="safer-migration-10"><a class="header" href="#safer-migration-10">Safer migration</a></h2>
<p>Currently, we don't know of a safe way to avoid this issue.</p>
<p>Report an issue at the <a href="https://github.com/kaaveland/eugene">tracker</a> if
you know a way!</p>
<h2 id="eugene-report-examples-10"><a class="header" href="#eugene-report-examples-10">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E11/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E11/unsafe_trace.html">Problem traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="w12-multiple-alter-table-statements-where-one-will-do"><a class="header" href="#w12-multiple-alter-table-statements-where-one-will-do"><code>W12</code> Multiple <code>ALTER TABLE</code> statements where one will do</a></h1>
<h2 id="description-11"><a class="header" href="#description-11">Description</a></h2>
<p><strong>Triggered when</strong>: Multiple <code>ALTER TABLE</code> statements targets the same table.</p>
<p><strong>Effect</strong>: If the statements require table scans, there will be more scans than necessary.</p>
<p><strong>Workaround</strong>: Combine the statements into one, separating the action with commas.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code></p>
<h2 id="problematic-migration-11"><a class="header" href="#problematic-migration-11">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text,
    email text
);

-- 2.sql
set lock_timeout = '2s';
alter table authors
    alter column name set not null;
-- eugene: ignore E2, E4
alter table authors
    alter column email set not null;
</code></pre>
<h2 id="safer-migration-11"><a class="header" href="#safer-migration-11">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text,
    email text
);

-- 2.sql
set lock_timeout = '2s';
-- eugene: ignore E2
alter table authors
  alter column name set not null,
  alter column email set not null;
</code></pre>
<h2 id="eugene-report-examples-11"><a class="header" href="#eugene-report-examples-11">Eugene report examples</a></h2>
<ul>
<li><a href="hints/W12/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/W12/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/W12/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/W12/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="w13-creating-an-enum"><a class="header" href="#w13-creating-an-enum"><code>W13</code> Creating an enum</a></h1>
<h2 id="description-12"><a class="header" href="#description-12">Description</a></h2>
<p><strong>Triggered when</strong>: A new enum was created.</p>
<p><strong>Effect</strong>: Removing values from an enum requires difficult migrations, and associating more data with an enum value is difficult.</p>
<p><strong>Workaround</strong>: Use a foreign key to a lookup table instead.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code></p>
<h2 id="problematic-migration-12"><a class="header" href="#problematic-migration-12">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create type document_type
    as enum ('invoice', 'receipt', 'other');
create table document (
    id int generated always as identity
        primary key,
    type document_type
);
</code></pre>
<h2 id="safer-migration-12"><a class="header" href="#safer-migration-12">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table document_type(
    type_name text primary key
);
insert into document_type
  values('invoice'), ('receipt'), ('other');
create table document (
    id int generated always as identity
        primary key,
    type text
        references document_type(type_name)
);
</code></pre>
<h2 id="eugene-report-examples-12"><a class="header" href="#eugene-report-examples-12">Eugene report examples</a></h2>
<ul>
<li><a href="hints/W13/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/W13/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/W13/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/W13/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="w14-adding-a-primary-key-using-an-index"><a class="header" href="#w14-adding-a-primary-key-using-an-index"><code>W14</code> Adding a primary key using an index</a></h1>
<h2 id="description-13"><a class="header" href="#description-13">Description</a></h2>
<p><strong>Triggered when</strong>: A primary key was added using an index on the table.</p>
<p><strong>Effect</strong>: This can cause postgres to alter the index columns to be <code>NOT NULL</code>.</p>
<p><strong>Workaround</strong>: Make sure that all the columns in the index are already <code>NOT NULL</code>.</p>
<p><strong>Detected by</strong>: <code>eugene lint</code></p>
<h2 id="problematic-migration-13"><a class="header" href="#problematic-migration-13">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    name text
);

-- 2.sql
create unique index concurrently
    authors_name_key on authors(name);

-- 3.sql
set local lock_timeout = '2s';
alter table authors
    add constraint authors_name_pkey
        primary key using index authors_name_key;
</code></pre>
<h2 id="safer-migration-13"><a class="header" href="#safer-migration-13">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table authors(
    name text
);

-- 2.sql
create unique index concurrently
    authors_name_key on authors(name);

-- 3.sql
set local lock_timeout = '2s';
-- eugene: ignore E2
-- This is a demo of W14, so we can ignore E2 instead of the
-- multi-step migration to make the column NOT NULL safely
alter table authors
    alter column name set not null;

-- 4.sql
alter table authors
    add constraint authors_name_pkey
        primary key using index authors_name_key;
</code></pre>
<h2 id="eugene-report-examples-13"><a class="header" href="#eugene-report-examples-13">Eugene report examples</a></h2>
<ul>
<li><a href="hints/W14/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/W14/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/W14/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/W14/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="e15-missing-index"><a class="header" href="#e15-missing-index"><code>E15</code> Missing index</a></h1>
<h2 id="description-14"><a class="header" href="#description-14">Description</a></h2>
<p><strong>Triggered when</strong>: A foreign key is missing a complete index on the referencing side.</p>
<p><strong>Effect</strong>: Updates and deletes on the referenced table may cause table scan on referencing table.</p>
<p><strong>Workaround</strong>: Create the missing index.</p>
<p><strong>Detected by</strong>: <code>eugene trace</code></p>
<h2 id="problematic-migration-14"><a class="header" href="#problematic-migration-14">Problematic migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table items
(
    id bigint generated always as identity primary key
);

create table purchase
(
    id   bigint generated always as identity primary key,
    item bigint not null references items (id) -- no index
);

-- 2.sql
set local lock_timeout = '2s';
-- eugene: ignore E6
create index purchase_item_idx on purchase (item)
    -- this is a partial index, not good enough for enforcing referential integrity
    where item = 1;

</code></pre>
<h2 id="safer-migration-14"><a class="header" href="#safer-migration-14">Safer migration</a></h2>
<pre><code class="language-sql">-- 1.sql
create table items
(
    id bigint generated always as identity primary key
);

create table purchase
(
    id   bigint generated always as identity primary key,
    item bigint not null references items (id)
);

-- 2.sql
set local lock_timeout = '2s';
-- eugene: ignore E6
create index purchase_item_idx on purchase(item);
</code></pre>
<h2 id="eugene-report-examples-14"><a class="header" href="#eugene-report-examples-14">Eugene report examples</a></h2>
<ul>
<li><a href="hints/E15/unsafe_lint.html">Problem linted by Eugene</a></li>
<li><a href="hints/E15/unsafe_trace.html">Problem traced by Eugene</a></li>
<li><a href="hints/E15/safer_trace.html">Fix linted by Eugene</a></li>
<li><a href="hints/E15/safer_trace.html">Fix traced by Eugene</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="appendix-example-reports"><a class="header" href="#appendix-example-reports">Appendix: Example Reports</a></h1>
<p>The next section shows sample reports generated by <code>eugene lint</code> and <code>eugene trace</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report"><a class="header" href="#-eugene-lint-report">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E1/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1"><a class="header" href="#-statement-number-1">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
)
</code></pre>
<h2 id="-eugene-lint-report-1"><a class="header" href="#-eugene-lint-report-1">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E1/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-1"><a class="header" href="#-statement-number-1-1">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2"><a class="header" href="#-statement-number-2">❌ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint name_not_null
        check (name is not null)
</code></pre>
<h4 id="triggered-rules"><a class="header" href="#triggered-rules">Triggered rules</a></h4>
<h5 id="e1-validating-table-with-a-new-constraint-1"><a class="header" href="#e1-validating-table-with-a-new-constraint-1"><code>E1</code>: <a href="https://kaveland.no/eugene/hints/E1/">Validating table with a new constraint</a></a></h5>
<p>Statement takes <code>AccessExclusiveLock</code> on <code>public.authors</code>, blocking reads until constraint <code>name_not_null</code> is validated.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-2"><a class="header" href="#-eugene-lint-report-2">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E1/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-2"><a class="header" href="#-statement-number-1-2">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
)
</code></pre>
<h2 id="-eugene-lint-report-3"><a class="header" href="#-eugene-lint-report-3">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E1/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-3"><a class="header" href="#-statement-number-1-3">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-1"><a class="header" href="#-statement-number-2-1">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint name_not_null
        check (name is not null) not valid
</code></pre>
<h2 id="-eugene-lint-report-4"><a class="header" href="#-eugene-lint-report-4">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E1/good/3.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-4"><a class="header" href="#-statement-number-1-4">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-2"><a class="header" href="#-statement-number-2-2">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    validate constraint name_not_null
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report"><a class="header" href="#-eugene-trace-report">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E1/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms"><a class="header" href="#-statement-number-1-for-10ms">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
)
</code></pre>
<h4 id="locks-at-start"><a class="header" href="#locks-at-start">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken"><a class="header" href="#new-locks-taken">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-1"><a class="header" href="#-eugene-trace-report-1">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E1/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-1"><a class="header" href="#-statement-number-1-for-10ms-1">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-1"><a class="header" href="#locks-at-start-1">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-1"><a class="header" href="#new-locks-taken-1">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms"><a class="header" href="#-statement-number-2-for-10ms">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint name_not_null
        check (name is not null)
</code></pre>
<h4 id="locks-at-start-2"><a class="header" href="#locks-at-start-2">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-2"><a class="header" href="#new-locks-taken-2">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-1"><a class="header" href="#triggered-rules-1">Triggered rules</a></h4>
<h5 id="e1-validating-table-with-a-new-constraint-2"><a class="header" href="#e1-validating-table-with-a-new-constraint-2"><code>E1</code>: <a href="https://kaveland.no/eugene/hints/E1/">Validating table with a new constraint</a></a></h5>
<p>A new constraint <code>name_not_null</code> of type <code>CHECK</code> was added to the table <code>public.authors</code> as <code>VALID</code>. Constraints that are <code>NOT VALID</code> can be made <code>VALID</code> by <code>ALTER TABLE public.authors VALIDATE CONSTRAINT name_not_null</code> which takes a lesser lock.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-2"><a class="header" href="#-eugene-trace-report-2">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E1/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-2"><a class="header" href="#-statement-number-1-for-10ms-2">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
)
</code></pre>
<h4 id="locks-at-start-3"><a class="header" href="#locks-at-start-3">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-3"><a class="header" href="#new-locks-taken-3">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-3"><a class="header" href="#-eugene-trace-report-3">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E1/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-3"><a class="header" href="#-statement-number-1-for-10ms-3">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-4"><a class="header" href="#locks-at-start-4">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-4"><a class="header" href="#new-locks-taken-4">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-1"><a class="header" href="#-statement-number-2-for-10ms-1">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint name_not_null
        check (name is not null) not valid
</code></pre>
<h4 id="locks-at-start-5"><a class="header" href="#locks-at-start-5">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-5"><a class="header" href="#new-locks-taken-5">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h2 id="-eugene-trace-report-4"><a class="header" href="#-eugene-trace-report-4">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E1/good/3.sql</code></p>
<h3 id="-statement-number-1-for-10ms-4"><a class="header" href="#-statement-number-1-for-10ms-4">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-6"><a class="header" href="#locks-at-start-6">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-6"><a class="header" href="#new-locks-taken-6">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-2"><a class="header" href="#-statement-number-2-for-10ms-2">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    validate constraint name_not_null
</code></pre>
<h4 id="locks-at-start-7"><a class="header" href="#locks-at-start-7">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-7"><a class="header" href="#new-locks-taken-7">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-5"><a class="header" href="#-eugene-lint-report-5">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E2/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-5"><a class="header" href="#-statement-number-1-5">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
)
</code></pre>
<h2 id="-eugene-lint-report-6"><a class="header" href="#-eugene-lint-report-6">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E2/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-6"><a class="header" href="#-statement-number-1-6">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-3"><a class="header" href="#-statement-number-2-3">❌ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    alter column name set not null
</code></pre>
<h4 id="triggered-rules-2"><a class="header" href="#triggered-rules-2">Triggered rules</a></h4>
<h5 id="e2-validating-table-with-a-new-not-null-column-1"><a class="header" href="#e2-validating-table-with-a-new-not-null-column-1"><code>E2</code>: <a href="https://kaveland.no/eugene/hints/E2/">Validating table with a new <code>NOT NULL</code> column</a></a></h5>
<p>Statement takes <code>AccessExclusiveLock</code> on <code>public.authors</code> by setting <code>name</code> to <code>NOT NULL</code> blocking reads until all rows are validated.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-7"><a class="header" href="#-eugene-lint-report-7">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E2/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-7"><a class="header" href="#-statement-number-1-7">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
)
</code></pre>
<h2 id="-eugene-lint-report-8"><a class="header" href="#-eugene-lint-report-8">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E2/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-8"><a class="header" href="#-statement-number-1-8">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-4"><a class="header" href="#-statement-number-2-4">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint check_name_not_null
        check (name is not null) not valid
</code></pre>
<h2 id="-eugene-lint-report-9"><a class="header" href="#-eugene-lint-report-9">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E2/good/3.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-9"><a class="header" href="#-statement-number-1-9">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-5"><a class="header" href="#-statement-number-2-5">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    validate constraint check_name_not_null
</code></pre>
<h2 id="-eugene-lint-report-10"><a class="header" href="#-eugene-lint-report-10">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E2/good/4.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-10"><a class="header" href="#-statement-number-1-10">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 4.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-6"><a class="header" href="#-statement-number-2-6">✅ Statement number 2</a></h3>
<pre><code class="language-sql">-- eugene trace knows name has a valid not null check, but eugene lint doesn't
-- eugene: ignore E2
alter table authors
    alter name set not null
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-5"><a class="header" href="#-eugene-trace-report-5">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E2/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-5"><a class="header" href="#-statement-number-1-for-10ms-5">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
)
</code></pre>
<h4 id="locks-at-start-8"><a class="header" href="#locks-at-start-8">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-8"><a class="header" href="#new-locks-taken-8">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-6"><a class="header" href="#-eugene-trace-report-6">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E2/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-6"><a class="header" href="#-statement-number-1-for-10ms-6">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-9"><a class="header" href="#locks-at-start-9">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-9"><a class="header" href="#new-locks-taken-9">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-3"><a class="header" href="#-statement-number-2-for-10ms-3">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    alter column name set not null
</code></pre>
<h4 id="locks-at-start-10"><a class="header" href="#locks-at-start-10">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-10"><a class="header" href="#new-locks-taken-10">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-3"><a class="header" href="#triggered-rules-3">Triggered rules</a></h4>
<h5 id="e2-validating-table-with-a-new-not-null-column-2"><a class="header" href="#e2-validating-table-with-a-new-not-null-column-2"><code>E2</code>: <a href="https://kaveland.no/eugene/hints/E2/">Validating table with a new <code>NOT NULL</code> column</a></a></h5>
<p>The column <code>name</code> in the table <code>public.authors</code> was changed to <code>NOT NULL</code>. If there is a <code>CHECK (name IS NOT NULL)</code> constraint on <code>public.authors</code>, this is safe. Splitting this kind of change into 3 steps can make it safe:</p>
<ol>
<li>Add a <code>CHECK (name IS NOT NULL) NOT VALID;</code> constraint on <code>public.authors</code>.</li>
<li>Validate the constraint in a later transaction, with <code>ALTER TABLE public.authors VALIDATE CONSTRAINT ...</code>.</li>
<li>Make the column <code>NOT NULL</code></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-7"><a class="header" href="#-eugene-trace-report-7">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E2/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-7"><a class="header" href="#-statement-number-1-for-10ms-7">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text
)
</code></pre>
<h4 id="locks-at-start-11"><a class="header" href="#locks-at-start-11">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-11"><a class="header" href="#new-locks-taken-11">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-8"><a class="header" href="#-eugene-trace-report-8">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E2/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-8"><a class="header" href="#-statement-number-1-for-10ms-8">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-12"><a class="header" href="#locks-at-start-12">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-12"><a class="header" href="#new-locks-taken-12">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-4"><a class="header" href="#-statement-number-2-for-10ms-4">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint check_name_not_null
        check (name is not null) not valid
</code></pre>
<h4 id="locks-at-start-13"><a class="header" href="#locks-at-start-13">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-13"><a class="header" href="#new-locks-taken-13">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h2 id="-eugene-trace-report-9"><a class="header" href="#-eugene-trace-report-9">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E2/good/3.sql</code></p>
<h3 id="-statement-number-1-for-10ms-9"><a class="header" href="#-statement-number-1-for-10ms-9">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-14"><a class="header" href="#locks-at-start-14">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-14"><a class="header" href="#new-locks-taken-14">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-5"><a class="header" href="#-statement-number-2-for-10ms-5">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    validate constraint check_name_not_null
</code></pre>
<h4 id="locks-at-start-15"><a class="header" href="#locks-at-start-15">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-15"><a class="header" href="#new-locks-taken-15">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-10"><a class="header" href="#-eugene-trace-report-10">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E2/good/4.sql</code></p>
<h3 id="-statement-number-1-for-10ms-10"><a class="header" href="#-statement-number-1-for-10ms-10">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 4.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-16"><a class="header" href="#locks-at-start-16">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-16"><a class="header" href="#new-locks-taken-16">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-6"><a class="header" href="#-statement-number-2-for-10ms-6">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene trace knows name has a valid not null check, but eugene lint doesn't
-- eugene: ignore E2
alter table authors
    alter name set not null
</code></pre>
<h4 id="locks-at-start-17"><a class="header" href="#locks-at-start-17">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-17"><a class="header" href="#new-locks-taken-17">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-11"><a class="header" href="#-eugene-lint-report-11">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E3/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-11"><a class="header" href="#-statement-number-1-11">❌ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null,
    meta json
)
</code></pre>
<h4 id="triggered-rules-4"><a class="header" href="#triggered-rules-4">Triggered rules</a></h4>
<h5 id="e3-add-a-new-json-column-1"><a class="header" href="#e3-add-a-new-json-column-1"><code>E3</code>: <a href="https://kaveland.no/eugene/hints/E3/">Add a new JSON column</a></a></h5>
<p>Created column <code>meta</code> with type <code>json</code>. The <code>json</code> type does not support equality and should not be used, use <code>jsonb</code> instead.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-12"><a class="header" href="#-eugene-lint-report-12">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E3/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-12"><a class="header" href="#-statement-number-1-12">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null,
    meta jsonb
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-11"><a class="header" href="#-eugene-trace-report-11">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E3/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-11"><a class="header" href="#-statement-number-1-for-10ms-11">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null,
    meta json
)
</code></pre>
<h4 id="locks-at-start-18"><a class="header" href="#locks-at-start-18">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-18"><a class="header" href="#new-locks-taken-18">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-12"><a class="header" href="#-eugene-trace-report-12">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E3/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-12"><a class="header" href="#-statement-number-1-for-10ms-12">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null,
    meta jsonb
)
</code></pre>
<h4 id="locks-at-start-19"><a class="header" href="#locks-at-start-19">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-19"><a class="header" href="#new-locks-taken-19">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-13"><a class="header" href="#-eugene-lint-report-13">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E4/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-13"><a class="header" href="#-statement-number-1-13">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-14"><a class="header" href="#-eugene-lint-report-14">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E4/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-14"><a class="header" href="#-statement-number-1-14">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-7"><a class="header" href="#-statement-number-2-7">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add column email text not null
</code></pre>
<h3 id="-statement-number-3"><a class="header" href="#-statement-number-3">❌ Statement number 3</a></h3>
<pre><code class="language-sql">select count(*) from authors
</code></pre>
<h4 id="triggered-rules-5"><a class="header" href="#triggered-rules-5">Triggered rules</a></h4>
<h5 id="e4-running-more-statements-after-taking-accessexclusivelock-1"><a class="header" href="#e4-running-more-statements-after-taking-accessexclusivelock-1"><code>E4</code>: <a href="https://kaveland.no/eugene/hints/E4/">Running more statements after taking <code>AccessExclusiveLock</code></a></a></h5>
<p>Running more statements after taking <code>AccessExclusiveLock</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-15"><a class="header" href="#-eugene-lint-report-15">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E4/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-15"><a class="header" href="#-statement-number-1-15">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-16"><a class="header" href="#-eugene-lint-report-16">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E4/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-16"><a class="header" href="#-statement-number-1-16">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-8"><a class="header" href="#-statement-number-2-8">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add column email text not null
</code></pre>
<h2 id="-eugene-lint-report-17"><a class="header" href="#-eugene-lint-report-17">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E4/good/3.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-17"><a class="header" href="#-statement-number-1-17">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 3.sql
select count(*) from authors
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-13"><a class="header" href="#-eugene-trace-report-13">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E4/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-13"><a class="header" href="#-statement-number-1-for-10ms-13">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-20"><a class="header" href="#locks-at-start-20">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-20"><a class="header" href="#new-locks-taken-20">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-14"><a class="header" href="#-eugene-trace-report-14">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E4/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-14"><a class="header" href="#-statement-number-1-for-10ms-14">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-21"><a class="header" href="#locks-at-start-21">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-21"><a class="header" href="#new-locks-taken-21">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-7"><a class="header" href="#-statement-number-2-for-10ms-7">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add column email text not null
</code></pre>
<h4 id="locks-at-start-22"><a class="header" href="#locks-at-start-22">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-22"><a class="header" href="#new-locks-taken-22">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h3 id="-statement-number-3-for-10ms"><a class="header" href="#-statement-number-3-for-10ms">❌ Statement number 3 for 10ms</a></h3>
<pre><code class="language-sql">select count(*) from authors
</code></pre>
<h4 id="locks-at-start-23"><a class="header" href="#locks-at-start-23">Locks at start</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="new-locks-taken-23"><a class="header" href="#new-locks-taken-23">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h4 id="triggered-rules-6"><a class="header" href="#triggered-rules-6">Triggered rules</a></h4>
<h5 id="e4-running-more-statements-after-taking-accessexclusivelock-2"><a class="header" href="#e4-running-more-statements-after-taking-accessexclusivelock-2"><code>E4</code>: <a href="https://kaveland.no/eugene/hints/E4/">Running more statements after taking <code>AccessExclusiveLock</code></a></a></h5>
<p>The statement is running while holding an <code>AccessExclusiveLock</code> on the Table <code>public.authors</code>, blocking all other transactions from accessing it.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-15"><a class="header" href="#-eugene-trace-report-15">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E4/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-15"><a class="header" href="#-statement-number-1-for-10ms-15">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-24"><a class="header" href="#locks-at-start-24">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-24"><a class="header" href="#new-locks-taken-24">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-16"><a class="header" href="#-eugene-trace-report-16">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E4/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-16"><a class="header" href="#-statement-number-1-for-10ms-16">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-25"><a class="header" href="#locks-at-start-25">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-25"><a class="header" href="#new-locks-taken-25">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-8"><a class="header" href="#-statement-number-2-for-10ms-8">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add column email text not null
</code></pre>
<h4 id="locks-at-start-26"><a class="header" href="#locks-at-start-26">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-26"><a class="header" href="#new-locks-taken-26">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h2 id="-eugene-trace-report-17"><a class="header" href="#-eugene-trace-report-17">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E4/good/3.sql</code></p>
<h3 id="-statement-number-1-for-10ms-17"><a class="header" href="#-statement-number-1-for-10ms-17">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 3.sql
select count(*) from authors
</code></pre>
<h4 id="locks-at-start-27"><a class="header" href="#locks-at-start-27">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-27"><a class="header" href="#new-locks-taken-27">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-18"><a class="header" href="#-eugene-lint-report-18">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E5/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-18"><a class="header" href="#-statement-number-1-18">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
)
</code></pre>
<h2 id="-eugene-lint-report-19"><a class="header" href="#-eugene-lint-report-19">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E5/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-19"><a class="header" href="#-statement-number-1-19">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-9"><a class="header" href="#-statement-number-2-9">❌ Statement number 2</a></h3>
<pre><code class="language-sql">alter table prices
    alter price set data type bigint
</code></pre>
<h4 id="triggered-rules-7"><a class="header" href="#triggered-rules-7">Triggered rules</a></h4>
<h5 id="e5-type-change-requiring-table-rewrite-1"><a class="header" href="#e5-type-change-requiring-table-rewrite-1"><code>E5</code>: <a href="https://kaveland.no/eugene/hints/E5/">Type change requiring table rewrite</a></a></h5>
<p>Changed type of column <code>price</code> to <code>pg_catalog.int8</code> in <code>.prices</code>. This operation requires a full table rewrite with <code>AccessExclusiveLock</code> if <code>pg_catalog.int8</code> is not binary compatible with the previous type of <code>price</code>. Prefer adding a new column with the new type, then dropping/renaming..</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-20"><a class="header" href="#-eugene-lint-report-20">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E5/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-20"><a class="header" href="#-statement-number-1-20">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
)
</code></pre>
<h2 id="-eugene-lint-report-21"><a class="header" href="#-eugene-lint-report-21">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E5/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-21"><a class="header" href="#-statement-number-1-21">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-10"><a class="header" href="#-statement-number-2-10">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table prices
    add column new_price bigint
</code></pre>
<h2 id="-eugene-lint-report-22"><a class="header" href="#-eugene-lint-report-22">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E5/good/3.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-22"><a class="header" href="#-statement-number-1-22">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 3.sql
update prices set new_price = price :: bigint
</code></pre>
<h3 id="-statement-number-2-11"><a class="header" href="#-statement-number-2-11">✅ Statement number 2</a></h3>
<pre><code class="language-sql">set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-3-1"><a class="header" href="#-statement-number-3-1">✅ Statement number 3</a></h3>
<pre><code class="language-sql">alter table prices
    add constraint check_new_price_not_null
        check (new_price is not null) not valid
</code></pre>
<h2 id="-eugene-lint-report-23"><a class="header" href="#-eugene-lint-report-23">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E5/good/4.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-23"><a class="header" href="#-statement-number-1-23">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 4.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-12"><a class="header" href="#-statement-number-2-12">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table prices
    validate constraint check_new_price_not_null,
    drop column price
</code></pre>
<h3 id="-statement-number-3-2"><a class="header" href="#-statement-number-3-2">✅ Statement number 3</a></h3>
<pre><code class="language-sql">-- eugene: ignore E4
-- this has to run in the same transaction as dropping the old price column
alter table prices
    rename column new_price to price
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-18"><a class="header" href="#-eugene-trace-report-18">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E5/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-18"><a class="header" href="#-statement-number-1-for-10ms-18">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
)
</code></pre>
<h4 id="locks-at-start-28"><a class="header" href="#locks-at-start-28">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-28"><a class="header" href="#new-locks-taken-28">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-19"><a class="header" href="#-eugene-trace-report-19">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E5/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-19"><a class="header" href="#-statement-number-1-for-10ms-19">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-29"><a class="header" href="#locks-at-start-29">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-29"><a class="header" href="#new-locks-taken-29">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-9"><a class="header" href="#-statement-number-2-for-10ms-9">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table prices
    alter price set data type bigint
</code></pre>
<h4 id="locks-at-start-30"><a class="header" href="#locks-at-start-30">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-30"><a class="header" href="#new-locks-taken-30">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>prices_pkey</code></td><td><code>AccessExclusiveLock</code></td><td>Index</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-8"><a class="header" href="#triggered-rules-8">Triggered rules</a></h4>
<h5 id="e5-type-change-requiring-table-rewrite-2"><a class="header" href="#e5-type-change-requiring-table-rewrite-2"><code>E5</code>: <a href="https://kaveland.no/eugene/hints/E5/">Type change requiring table rewrite</a></a></h5>
<p>The column <code>price</code> in the table <code>public.prices</code> was changed from type <code>int4</code> to <code>int8</code>. This requires an <code>AccessExclusiveLock</code> that will block all other transactions from using the table while it is being rewritten.</p>
<h5 id="e6-creating-a-new-index-on-an-existing-table-1"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table-1"><code>E6</code>: <a href="https://kaveland.no/eugene/hints/E6/">Creating a new index on an existing table</a></a></h5>
<p>A new index was created on the table <code>public.prices</code>. The index was created non-concurrently, which blocks all writes to the table. Use <code>CREATE INDEX CONCURRENTLY</code> to avoid blocking writes.</p>
<h5 id="e10-rewrote-table-or-index-while-holding-dangerous-lock-1"><a class="header" href="#e10-rewrote-table-or-index-while-holding-dangerous-lock-1"><code>E10</code>: <a href="https://kaveland.no/eugene/hints/E10/">Rewrote table or index while holding dangerous lock</a></a></h5>
<p>The Table <code>public.prices</code> was rewritten while holding <code>AccessExclusiveLock</code> on the Table <code>public.prices</code>. This blocks <code>SELECT</code>, <code>FOR UPDATE</code>, <code>FOR NO KEY UPDATE</code>, <code>FOR SHARE</code>, <code>FOR KEY SHARE</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>INSERT</code>, <code>MERGE</code> while the rewrite is in progress.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-20"><a class="header" href="#-eugene-trace-report-20">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E5/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-20"><a class="header" href="#-statement-number-1-for-10ms-20">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
)
</code></pre>
<h4 id="locks-at-start-31"><a class="header" href="#locks-at-start-31">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-31"><a class="header" href="#new-locks-taken-31">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-21"><a class="header" href="#-eugene-trace-report-21">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E5/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-21"><a class="header" href="#-statement-number-1-for-10ms-21">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-32"><a class="header" href="#locks-at-start-32">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-32"><a class="header" href="#new-locks-taken-32">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-10"><a class="header" href="#-statement-number-2-for-10ms-10">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table prices
    add column new_price bigint
</code></pre>
<h4 id="locks-at-start-33"><a class="header" href="#locks-at-start-33">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-33"><a class="header" href="#new-locks-taken-33">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h2 id="-eugene-trace-report-22"><a class="header" href="#-eugene-trace-report-22">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E5/good/3.sql</code></p>
<h3 id="-statement-number-1-for-10ms-22"><a class="header" href="#-statement-number-1-for-10ms-22">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 3.sql
update prices set new_price = price :: bigint
</code></pre>
<h4 id="locks-at-start-34"><a class="header" href="#locks-at-start-34">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-34"><a class="header" href="#new-locks-taken-34">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-11"><a class="header" href="#-statement-number-2-for-10ms-11">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-35"><a class="header" href="#locks-at-start-35">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-35"><a class="header" href="#new-locks-taken-35">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-3-for-10ms-1"><a class="header" href="#-statement-number-3-for-10ms-1">✅ Statement number 3 for 10ms</a></h3>
<pre><code class="language-sql">alter table prices
    add constraint check_new_price_not_null
        check (new_price is not null) not valid
</code></pre>
<h4 id="locks-at-start-36"><a class="header" href="#locks-at-start-36">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-36"><a class="header" href="#new-locks-taken-36">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h2 id="-eugene-trace-report-23"><a class="header" href="#-eugene-trace-report-23">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E5/good/4.sql</code></p>
<h3 id="-statement-number-1-for-10ms-23"><a class="header" href="#-statement-number-1-for-10ms-23">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 4.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-37"><a class="header" href="#locks-at-start-37">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-37"><a class="header" href="#new-locks-taken-37">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-12"><a class="header" href="#-statement-number-2-for-10ms-12">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table prices
    validate constraint check_new_price_not_null,
    drop column price
</code></pre>
<h4 id="locks-at-start-38"><a class="header" href="#locks-at-start-38">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-38"><a class="header" href="#new-locks-taken-38">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h3 id="-statement-number-3-for-10ms-2"><a class="header" href="#-statement-number-3-for-10ms-2">✅ Statement number 3 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene: ignore E4
-- this has to run in the same transaction as dropping the old price column
alter table prices
    rename column new_price to price
</code></pre>
<h4 id="locks-at-start-39"><a class="header" href="#locks-at-start-39">Locks at start</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="new-locks-taken-39"><a class="header" href="#new-locks-taken-39">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-24"><a class="header" href="#-eugene-lint-report-24">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E6/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-24"><a class="header" href="#-statement-number-1-24">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-25"><a class="header" href="#-eugene-lint-report-25">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E6/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-25"><a class="header" href="#-statement-number-1-25">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-13"><a class="header" href="#-statement-number-2-13">❌ Statement number 2</a></h3>
<pre><code class="language-sql">create index
    authors_name_idx on authors (name)
</code></pre>
<h4 id="triggered-rules-9"><a class="header" href="#triggered-rules-9">Triggered rules</a></h4>
<h5 id="e6-creating-a-new-index-on-an-existing-table-2"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table-2"><code>E6</code>: <a href="https://kaveland.no/eugene/hints/E6/">Creating a new index on an existing table</a></a></h5>
<p>Statement takes <code>ShareLock</code> on <code>public.authors</code>, blocking writes while creating index <code>public.authors_name_idx</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-26"><a class="header" href="#-eugene-lint-report-26">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E6/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-26"><a class="header" href="#-statement-number-1-26">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-27"><a class="header" href="#-eugene-lint-report-27">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E6/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-27"><a class="header" href="#-statement-number-1-27">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
create index concurrently
    authors_name_idx on authors (name)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-24"><a class="header" href="#-eugene-trace-report-24">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E6/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-24"><a class="header" href="#-statement-number-1-for-10ms-24">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-40"><a class="header" href="#locks-at-start-40">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-40"><a class="header" href="#new-locks-taken-40">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-25"><a class="header" href="#-eugene-trace-report-25">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E6/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-25"><a class="header" href="#-statement-number-1-for-10ms-25">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-41"><a class="header" href="#locks-at-start-41">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-41"><a class="header" href="#new-locks-taken-41">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-13"><a class="header" href="#-statement-number-2-for-10ms-13">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">create index
    authors_name_idx on authors (name)
</code></pre>
<h4 id="locks-at-start-42"><a class="header" href="#locks-at-start-42">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-42"><a class="header" href="#new-locks-taken-42">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-10"><a class="header" href="#triggered-rules-10">Triggered rules</a></h4>
<h5 id="e6-creating-a-new-index-on-an-existing-table-3"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table-3"><code>E6</code>: <a href="https://kaveland.no/eugene/hints/E6/">Creating a new index on an existing table</a></a></h5>
<p>A new index was created on the table <code>public.authors</code>. The index <code>public.authors_name_idx</code> was created non-concurrently, which blocks all writes to the table. Use <code>CREATE INDEX CONCURRENTLY</code> to avoid blocking writes.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-26"><a class="header" href="#-eugene-trace-report-26">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E6/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-26"><a class="header" href="#-statement-number-1-for-10ms-26">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-43"><a class="header" href="#locks-at-start-43">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-43"><a class="header" href="#new-locks-taken-43">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-27"><a class="header" href="#-eugene-trace-report-27">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E6/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-27"><a class="header" href="#-statement-number-1-for-10ms-27">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
create index concurrently
    authors_name_idx on authors (name)
</code></pre>
<h4 id="locks-at-start-44"><a class="header" href="#locks-at-start-44">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-44"><a class="header" href="#new-locks-taken-44">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-28"><a class="header" href="#-eugene-lint-report-28">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E7/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-28"><a class="header" href="#-statement-number-1-28">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-29"><a class="header" href="#-eugene-lint-report-29">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E7/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-29"><a class="header" href="#-statement-number-1-29">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-14"><a class="header" href="#-statement-number-2-14">❌ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint unique_name unique(name)
</code></pre>
<h4 id="triggered-rules-11"><a class="header" href="#triggered-rules-11">Triggered rules</a></h4>
<h5 id="e7-creating-a-new-unique-constraint-1"><a class="header" href="#e7-creating-a-new-unique-constraint-1"><code>E7</code>: <a href="https://kaveland.no/eugene/hints/E7/">Creating a new unique constraint</a></a></h5>
<p>New constraint unique_name creates implicit index on <code>public.authors</code>, blocking writes until index is created and validated.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-30"><a class="header" href="#-eugene-lint-report-30">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E7/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-30"><a class="header" href="#-statement-number-1-30">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-31"><a class="header" href="#-eugene-lint-report-31">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E7/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-31"><a class="header" href="#-statement-number-1-31">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
create unique index concurrently
    authors_name_unique on authors(name)
</code></pre>
<h2 id="-eugene-lint-report-32"><a class="header" href="#-eugene-lint-report-32">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E7/good/3.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-32"><a class="header" href="#-statement-number-1-32">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-15"><a class="header" href="#-statement-number-2-15">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint unique_name
        unique using index authors_name_unique
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-28"><a class="header" href="#-eugene-trace-report-28">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E7/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-28"><a class="header" href="#-statement-number-1-for-10ms-28">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-45"><a class="header" href="#locks-at-start-45">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-45"><a class="header" href="#new-locks-taken-45">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-29"><a class="header" href="#-eugene-trace-report-29">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E7/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-29"><a class="header" href="#-statement-number-1-for-10ms-29">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-46"><a class="header" href="#locks-at-start-46">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-46"><a class="header" href="#new-locks-taken-46">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-14"><a class="header" href="#-statement-number-2-for-10ms-14">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint unique_name unique(name)
</code></pre>
<h4 id="locks-at-start-47"><a class="header" href="#locks-at-start-47">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-47"><a class="header" href="#new-locks-taken-47">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-12"><a class="header" href="#triggered-rules-12">Triggered rules</a></h4>
<h5 id="e6-creating-a-new-index-on-an-existing-table-4"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table-4"><code>E6</code>: <a href="https://kaveland.no/eugene/hints/E6/">Creating a new index on an existing table</a></a></h5>
<p>A new index was created on the table <code>public.authors</code>. The index <code>public.unique_name</code> was created non-concurrently, which blocks all writes to the table. Use <code>CREATE INDEX CONCURRENTLY</code> to avoid blocking writes.</p>
<h5 id="e7-creating-a-new-unique-constraint-2"><a class="header" href="#e7-creating-a-new-unique-constraint-2"><code>E7</code>: <a href="https://kaveland.no/eugene/hints/E7/">Creating a new unique constraint</a></a></h5>
<p>A new unique constraint <code>unique_name</code> was added to the table <code>public.authors</code>. This constraint creates a unique index on the table, and blocks all writes. Consider creating the index concurrently in a separate transaction, then adding the unique constraint by using the index: <code>ALTER TABLE public.authors ADD CONSTRAINT unique_name UNIQUE USING INDEX public.unique_name;</code></p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-30"><a class="header" href="#-eugene-trace-report-30">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E7/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-30"><a class="header" href="#-statement-number-1-for-10ms-30">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-48"><a class="header" href="#locks-at-start-48">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-48"><a class="header" href="#new-locks-taken-48">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-31"><a class="header" href="#-eugene-trace-report-31">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E7/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-31"><a class="header" href="#-statement-number-1-for-10ms-31">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
create unique index concurrently
    authors_name_unique on authors(name)
</code></pre>
<h4 id="locks-at-start-49"><a class="header" href="#locks-at-start-49">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-49"><a class="header" href="#new-locks-taken-49">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-32"><a class="header" href="#-eugene-trace-report-32">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E7/good/3.sql</code></p>
<h3 id="-statement-number-1-for-10ms-32"><a class="header" href="#-statement-number-1-for-10ms-32">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-50"><a class="header" href="#locks-at-start-50">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-50"><a class="header" href="#new-locks-taken-50">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-15"><a class="header" href="#-statement-number-2-for-10ms-15">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint unique_name
        unique using index authors_name_unique
</code></pre>
<h4 id="locks-at-start-51"><a class="header" href="#locks-at-start-51">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-51"><a class="header" href="#new-locks-taken-51">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-33"><a class="header" href="#-eugene-lint-report-33">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E8/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-33"><a class="header" href="#-statement-number-1-33">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-34"><a class="header" href="#-eugene-lint-report-34">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E8/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-34"><a class="header" href="#-statement-number-1-34">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-16"><a class="header" href="#-statement-number-2-16">❌ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint authors_name_excl
        exclude (name with =)
</code></pre>
<h4 id="triggered-rules-13"><a class="header" href="#triggered-rules-13">Triggered rules</a></h4>
<h5 id="e8-creating-a-new-exclusion-constraint-1"><a class="header" href="#e8-creating-a-new-exclusion-constraint-1"><code>E8</code>: <a href="https://kaveland.no/eugene/hints/E8/">Creating a new exclusion constraint</a></a></h5>
<p>Statement takes <code>AccessExclusiveLock</code> on <code>public.authors</code>, blocking reads and writes until constraint <code>authors_name_excl</code> is validated and has created index.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-33"><a class="header" href="#-eugene-trace-report-33">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E8/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-33"><a class="header" href="#-statement-number-1-for-10ms-33">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-52"><a class="header" href="#locks-at-start-52">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-52"><a class="header" href="#new-locks-taken-52">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-34"><a class="header" href="#-eugene-trace-report-34">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E8/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-34"><a class="header" href="#-statement-number-1-for-10ms-34">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-53"><a class="header" href="#locks-at-start-53">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-53"><a class="header" href="#new-locks-taken-53">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-16"><a class="header" href="#-statement-number-2-for-10ms-16">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint authors_name_excl
        exclude (name with =)
</code></pre>
<h4 id="locks-at-start-54"><a class="header" href="#locks-at-start-54">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-54"><a class="header" href="#new-locks-taken-54">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-14"><a class="header" href="#triggered-rules-14">Triggered rules</a></h4>
<h5 id="e6-creating-a-new-index-on-an-existing-table-5"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table-5"><code>E6</code>: <a href="https://kaveland.no/eugene/hints/E6/">Creating a new index on an existing table</a></a></h5>
<p>A new index was created on the table <code>public.authors</code>. The index <code>public.authors_name_excl</code> was created non-concurrently, which blocks all writes to the table. Use <code>CREATE INDEX CONCURRENTLY</code> to avoid blocking writes.</p>
<h5 id="e8-creating-a-new-exclusion-constraint-2"><a class="header" href="#e8-creating-a-new-exclusion-constraint-2"><code>E8</code>: <a href="https://kaveland.no/eugene/hints/E8/">Creating a new exclusion constraint</a></a></h5>
<p>A new exclusion constraint <code>authors_name_excl</code> was added to the table <code>public.authors</code>. There is no safe way to add an exclusion constraint to an existing table. This constraint creates an index on the table, and blocks all reads and writes.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-35"><a class="header" href="#-eugene-lint-report-35">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E9/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-35"><a class="header" href="#-statement-number-1-35">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-36"><a class="header" href="#-eugene-lint-report-36">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E9/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-36"><a class="header" href="#-statement-number-1-36">❌ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
alter table authors add column email text
</code></pre>
<h4 id="triggered-rules-15"><a class="header" href="#triggered-rules-15">Triggered rules</a></h4>
<h5 id="e9-taking-dangerous-lock-without-timeout-1"><a class="header" href="#e9-taking-dangerous-lock-without-timeout-1"><code>E9</code>: <a href="https://kaveland.no/eugene/hints/E9/">Taking dangerous lock without timeout</a></a></h5>
<p>Statement takes lock on <code>public.authors</code>, but does not set a lock timeout.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-37"><a class="header" href="#-eugene-lint-report-37">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E9/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-37"><a class="header" href="#-statement-number-1-37">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-38"><a class="header" href="#-eugene-lint-report-38">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E9/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-38"><a class="header" href="#-statement-number-1-38">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-17"><a class="header" href="#-statement-number-2-17">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors add column email text
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-35"><a class="header" href="#-eugene-trace-report-35">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E9/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-35"><a class="header" href="#-statement-number-1-for-10ms-35">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-55"><a class="header" href="#locks-at-start-55">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-55"><a class="header" href="#new-locks-taken-55">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-36"><a class="header" href="#-eugene-trace-report-36">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E9/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-36"><a class="header" href="#-statement-number-1-for-10ms-36">❌ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
alter table authors add column email text
</code></pre>
<h4 id="locks-at-start-56"><a class="header" href="#locks-at-start-56">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-56"><a class="header" href="#new-locks-taken-56">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-16"><a class="header" href="#triggered-rules-16">Triggered rules</a></h4>
<h5 id="e9-taking-dangerous-lock-without-timeout-2"><a class="header" href="#e9-taking-dangerous-lock-without-timeout-2"><code>E9</code>: <a href="https://kaveland.no/eugene/hints/E9/">Taking dangerous lock without timeout</a></a></h5>
<p>The statement took <code>AccessExclusiveLock</code> on the Table <code>public.authors</code> without a timeout. It blocks <code>SELECT</code>, <code>FOR UPDATE</code>, <code>FOR NO KEY UPDATE</code>, <code>FOR SHARE</code>, <code>FOR KEY SHARE</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>INSERT</code>, <code>MERGE</code> while waiting to acquire the lock.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-37"><a class="header" href="#-eugene-trace-report-37">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E9/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-37"><a class="header" href="#-statement-number-1-for-10ms-37">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-57"><a class="header" href="#locks-at-start-57">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-57"><a class="header" href="#new-locks-taken-57">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-38"><a class="header" href="#-eugene-trace-report-38">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E9/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-38"><a class="header" href="#-statement-number-1-for-10ms-38">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-58"><a class="header" href="#locks-at-start-58">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-58"><a class="header" href="#new-locks-taken-58">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-17"><a class="header" href="#-statement-number-2-for-10ms-17">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors add column email text
</code></pre>
<h4 id="locks-at-start-59"><a class="header" href="#locks-at-start-59">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-59"><a class="header" href="#new-locks-taken-59">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-39"><a class="header" href="#-eugene-lint-report-39">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E10/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-39"><a class="header" href="#-statement-number-1-39">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
)
</code></pre>
<h3 id="-statement-number-2-18"><a class="header" href="#-statement-number-2-18">✅ Statement number 2</a></h3>
<pre><code class="language-sql">create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-40"><a class="header" href="#-eugene-lint-report-40">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E10/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-40"><a class="header" href="#-statement-number-1-40">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-19"><a class="header" href="#-statement-number-2-19">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors add column meta jsonb
</code></pre>
<h3 id="-statement-number-3-3"><a class="header" href="#-statement-number-3-3">✅ Statement number 3</a></h3>
<pre><code class="language-sql">-- eugene: ignore E5, E4
-- causes table rewrite, but this example isnt't about that
alter table prices
    alter price set data type bigint
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-41"><a class="header" href="#-eugene-lint-report-41">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E10/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-41"><a class="header" href="#-statement-number-1-41">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
)
</code></pre>
<h3 id="-statement-number-2-20"><a class="header" href="#-statement-number-2-20">✅ Statement number 2</a></h3>
<pre><code class="language-sql">create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h2 id="-eugene-lint-report-42"><a class="header" href="#-eugene-lint-report-42">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E10/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-42"><a class="header" href="#-statement-number-1-42">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-21"><a class="header" href="#-statement-number-2-21">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add column meta jsonb
</code></pre>
<h2 id="-eugene-lint-report-43"><a class="header" href="#-eugene-lint-report-43">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E10/good/3.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-43"><a class="header" href="#-statement-number-1-43">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-22"><a class="header" href="#-statement-number-2-22">✅ Statement number 2</a></h3>
<pre><code class="language-sql">-- eugene: ignore E5, E4
-- causes table rewrite, but this example isnt't about that
alter table prices
    alter price set data type bigint
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-39"><a class="header" href="#-eugene-trace-report-39">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E10/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-39"><a class="header" href="#-statement-number-1-for-10ms-39">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
)
</code></pre>
<h4 id="locks-at-start-60"><a class="header" href="#locks-at-start-60">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-60"><a class="header" href="#new-locks-taken-60">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-18"><a class="header" href="#-statement-number-2-for-10ms-18">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-61"><a class="header" href="#locks-at-start-61">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-61"><a class="header" href="#new-locks-taken-61">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-40"><a class="header" href="#-eugene-trace-report-40">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E10/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-40"><a class="header" href="#-statement-number-1-for-10ms-40">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-62"><a class="header" href="#locks-at-start-62">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-62"><a class="header" href="#new-locks-taken-62">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-19"><a class="header" href="#-statement-number-2-for-10ms-19">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors add column meta jsonb
</code></pre>
<h4 id="locks-at-start-63"><a class="header" href="#locks-at-start-63">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-63"><a class="header" href="#new-locks-taken-63">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h3 id="-statement-number-3-for-10ms-3"><a class="header" href="#-statement-number-3-for-10ms-3">❌ Statement number 3 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene: ignore E5, E4
-- causes table rewrite, but this example isnt't about that
alter table prices
    alter price set data type bigint
</code></pre>
<h4 id="locks-at-start-64"><a class="header" href="#locks-at-start-64">Locks at start</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="new-locks-taken-64"><a class="header" href="#new-locks-taken-64">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>prices_pkey</code></td><td><code>AccessExclusiveLock</code></td><td>Index</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-17"><a class="header" href="#triggered-rules-17">Triggered rules</a></h4>
<h5 id="e6-creating-a-new-index-on-an-existing-table-6"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table-6"><code>E6</code>: <a href="https://kaveland.no/eugene/hints/E6/">Creating a new index on an existing table</a></a></h5>
<p>A new index was created on the table <code>public.prices</code>. The index was created non-concurrently, which blocks all writes to the table. Use <code>CREATE INDEX CONCURRENTLY</code> to avoid blocking writes.</p>
<h5 id="e10-rewrote-table-or-index-while-holding-dangerous-lock-2"><a class="header" href="#e10-rewrote-table-or-index-while-holding-dangerous-lock-2"><code>E10</code>: <a href="https://kaveland.no/eugene/hints/E10/">Rewrote table or index while holding dangerous lock</a></a></h5>
<p>The Table <code>public.prices</code> was rewritten while holding <code>AccessExclusiveLock</code> on the Table <code>public.authors</code>. This blocks <code>SELECT</code>, <code>FOR UPDATE</code>, <code>FOR NO KEY UPDATE</code>, <code>FOR SHARE</code>, <code>FOR KEY SHARE</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>INSERT</code>, <code>MERGE</code> while the rewrite is in progress.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-41"><a class="header" href="#-eugene-trace-report-41">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E10/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-41"><a class="header" href="#-statement-number-1-for-10ms-41">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    id integer generated always as identity
        primary key,
    price int not null
)
</code></pre>
<h4 id="locks-at-start-65"><a class="header" href="#locks-at-start-65">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-65"><a class="header" href="#new-locks-taken-65">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-20"><a class="header" href="#-statement-number-2-for-10ms-20">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">create table authors (
    id integer generated always as identity
        primary key,
    name text not null
)
</code></pre>
<h4 id="locks-at-start-66"><a class="header" href="#locks-at-start-66">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-66"><a class="header" href="#new-locks-taken-66">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-42"><a class="header" href="#-eugene-trace-report-42">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E10/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-42"><a class="header" href="#-statement-number-1-for-10ms-42">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-67"><a class="header" href="#locks-at-start-67">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-67"><a class="header" href="#new-locks-taken-67">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-21"><a class="header" href="#-statement-number-2-for-10ms-21">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add column meta jsonb
</code></pre>
<h4 id="locks-at-start-68"><a class="header" href="#locks-at-start-68">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-68"><a class="header" href="#new-locks-taken-68">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h2 id="-eugene-trace-report-43"><a class="header" href="#-eugene-trace-report-43">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E10/good/3.sql</code></p>
<h3 id="-statement-number-1-for-10ms-43"><a class="header" href="#-statement-number-1-for-10ms-43">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-69"><a class="header" href="#locks-at-start-69">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-69"><a class="header" href="#new-locks-taken-69">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-22"><a class="header" href="#-statement-number-2-for-10ms-22">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene: ignore E5, E4
-- causes table rewrite, but this example isnt't about that
alter table prices
    alter price set data type bigint
</code></pre>
<h4 id="locks-at-start-70"><a class="header" href="#locks-at-start-70">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-70"><a class="header" href="#new-locks-taken-70">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>prices_pkey</code></td><td><code>AccessExclusiveLock</code></td><td>Index</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-18"><a class="header" href="#triggered-rules-18">Triggered rules</a></h4>
<h5 id="e6-creating-a-new-index-on-an-existing-table-7"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table-7"><code>E6</code>: <a href="https://kaveland.no/eugene/hints/E6/">Creating a new index on an existing table</a></a></h5>
<p>A new index was created on the table <code>public.prices</code>. The index was created non-concurrently, which blocks all writes to the table. Use <code>CREATE INDEX CONCURRENTLY</code> to avoid blocking writes.</p>
<h5 id="e10-rewrote-table-or-index-while-holding-dangerous-lock-3"><a class="header" href="#e10-rewrote-table-or-index-while-holding-dangerous-lock-3"><code>E10</code>: <a href="https://kaveland.no/eugene/hints/E10/">Rewrote table or index while holding dangerous lock</a></a></h5>
<p>The Table <code>public.prices</code> was rewritten while holding <code>AccessExclusiveLock</code> on the Table <code>public.prices</code>. This blocks <code>SELECT</code>, <code>FOR UPDATE</code>, <code>FOR NO KEY UPDATE</code>, <code>FOR SHARE</code>, <code>FOR KEY SHARE</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>INSERT</code>, <code>MERGE</code> while the rewrite is in progress.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-44"><a class="header" href="#-eugene-lint-report-44">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E11/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-44"><a class="header" href="#-statement-number-1-44">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    price int not null
)
</code></pre>
<h2 id="-eugene-lint-report-45"><a class="header" href="#-eugene-lint-report-45">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/E11/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-45"><a class="header" href="#-statement-number-1-45">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-23"><a class="header" href="#-statement-number-2-23">❌ Statement number 2</a></h3>
<pre><code class="language-sql">alter table prices
    add column id serial
</code></pre>
<h4 id="triggered-rules-19"><a class="header" href="#triggered-rules-19">Triggered rules</a></h4>
<h5 id="e11-adding-a-serial-or-generated--stored-column-1"><a class="header" href="#e11-adding-a-serial-or-generated--stored-column-1"><code>E11</code>: <a href="https://kaveland.no/eugene/hints/E11/">Adding a <code>SERIAL</code> or <code>GENERATED ... STORED</code> column</a></a></h5>
<p>Added column <code>id</code> with type that will force table rewrite  in <code>.prices</code>. <code>serial</code> types and <code>GENERATED ALWAYS as ... STORED</code> columns require a full table rewrite with <code>AccessExclusiveLock</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-44"><a class="header" href="#-eugene-trace-report-44">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E11/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-44"><a class="header" href="#-statement-number-1-for-10ms-44">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table prices (
    price int not null
)
</code></pre>
<h4 id="locks-at-start-71"><a class="header" href="#locks-at-start-71">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-71"><a class="header" href="#new-locks-taken-71">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-45"><a class="header" href="#-eugene-trace-report-45">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E11/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-45"><a class="header" href="#-statement-number-1-for-10ms-45">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-72"><a class="header" href="#locks-at-start-72">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-72"><a class="header" href="#new-locks-taken-72">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-23"><a class="header" href="#-statement-number-2-for-10ms-23">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table prices
    add column id serial
</code></pre>
<h4 id="locks-at-start-73"><a class="header" href="#locks-at-start-73">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-73"><a class="header" href="#new-locks-taken-73">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
<tr><td><code>public</code></td><td><code>prices</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-20"><a class="header" href="#triggered-rules-20">Triggered rules</a></h4>
<h5 id="e6-creating-a-new-index-on-an-existing-table-8"><a class="header" href="#e6-creating-a-new-index-on-an-existing-table-8"><code>E6</code>: <a href="https://kaveland.no/eugene/hints/E6/">Creating a new index on an existing table</a></a></h5>
<p>A new index was created on the table <code>public.prices</code>. The index was created non-concurrently, which blocks all writes to the table. Use <code>CREATE INDEX CONCURRENTLY</code> to avoid blocking writes.</p>
<h5 id="e10-rewrote-table-or-index-while-holding-dangerous-lock-4"><a class="header" href="#e10-rewrote-table-or-index-while-holding-dangerous-lock-4"><code>E10</code>: <a href="https://kaveland.no/eugene/hints/E10/">Rewrote table or index while holding dangerous lock</a></a></h5>
<p>The Table <code>public.prices</code> was rewritten while holding <code>AccessExclusiveLock</code> on the Table <code>public.prices</code>. This blocks <code>SELECT</code>, <code>FOR UPDATE</code>, <code>FOR NO KEY UPDATE</code>, <code>FOR SHARE</code>, <code>FOR KEY SHARE</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>INSERT</code>, <code>MERGE</code> while the rewrite is in progress.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-46"><a class="header" href="#-eugene-lint-report-46">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W12/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-46"><a class="header" href="#-statement-number-1-46">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text,
    email text
)
</code></pre>
<h2 id="-eugene-lint-report-47"><a class="header" href="#-eugene-lint-report-47">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/W12/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-47"><a class="header" href="#-statement-number-1-47">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-24"><a class="header" href="#-statement-number-2-24">✅ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    alter column name set not null
</code></pre>
<h3 id="-statement-number-3-4"><a class="header" href="#-statement-number-3-4">❌ Statement number 3</a></h3>
<pre><code class="language-sql">-- eugene: ignore E2, E4
alter table authors
    alter column email set not null
</code></pre>
<h4 id="triggered-rules-21"><a class="header" href="#triggered-rules-21">Triggered rules</a></h4>
<h5 id="w12-multiple-alter-table-statements-where-one-will-do-1"><a class="header" href="#w12-multiple-alter-table-statements-where-one-will-do-1"><code>W12</code>: <a href="https://kaveland.no/eugene/hints/W12/">Multiple <code>ALTER TABLE</code> statements where one will do</a></a></h5>
<p>Multiple <code>ALTER TABLE</code> statements on <code>public.authors</code>. Combine them into a single statement to avoid scanning the table multiple times..</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-48"><a class="header" href="#-eugene-lint-report-48">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W12/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-48"><a class="header" href="#-statement-number-1-48">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text,
    email text
)
</code></pre>
<h2 id="-eugene-lint-report-49"><a class="header" href="#-eugene-lint-report-49">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W12/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-49"><a class="header" href="#-statement-number-1-49">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-25"><a class="header" href="#-statement-number-2-25">✅ Statement number 2</a></h3>
<pre><code class="language-sql">-- eugene: ignore E2
alter table authors
  alter column name set not null,
  alter column email set not null
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-46"><a class="header" href="#-eugene-trace-report-46">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W12/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-46"><a class="header" href="#-statement-number-1-for-10ms-46">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text,
    email text
)
</code></pre>
<h4 id="locks-at-start-74"><a class="header" href="#locks-at-start-74">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-74"><a class="header" href="#new-locks-taken-74">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-47"><a class="header" href="#-eugene-trace-report-47">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/W12/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-47"><a class="header" href="#-statement-number-1-for-10ms-47">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-75"><a class="header" href="#locks-at-start-75">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-75"><a class="header" href="#new-locks-taken-75">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-24"><a class="header" href="#-statement-number-2-for-10ms-24">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    alter column name set not null
</code></pre>
<h4 id="locks-at-start-76"><a class="header" href="#locks-at-start-76">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-76"><a class="header" href="#new-locks-taken-76">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-22"><a class="header" href="#triggered-rules-22">Triggered rules</a></h4>
<h5 id="e2-validating-table-with-a-new-not-null-column-3"><a class="header" href="#e2-validating-table-with-a-new-not-null-column-3"><code>E2</code>: <a href="https://kaveland.no/eugene/hints/E2/">Validating table with a new <code>NOT NULL</code> column</a></a></h5>
<p>The column <code>name</code> in the table <code>public.authors</code> was changed to <code>NOT NULL</code>. If there is a <code>CHECK (name IS NOT NULL)</code> constraint on <code>public.authors</code>, this is safe. Splitting this kind of change into 3 steps can make it safe:</p>
<ol>
<li>Add a <code>CHECK (name IS NOT NULL) NOT VALID;</code> constraint on <code>public.authors</code>.</li>
<li>Validate the constraint in a later transaction, with <code>ALTER TABLE public.authors VALIDATE CONSTRAINT ...</code>.</li>
<li>Make the column <code>NOT NULL</code></li>
</ol>
<h3 id="-statement-number-3-for-10ms-4"><a class="header" href="#-statement-number-3-for-10ms-4">✅ Statement number 3 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene: ignore E2, E4
alter table authors
    alter column email set not null
</code></pre>
<h4 id="locks-at-start-77"><a class="header" href="#locks-at-start-77">Locks at start</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="new-locks-taken-77"><a class="header" href="#new-locks-taken-77">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-48"><a class="header" href="#-eugene-trace-report-48">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W12/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-48"><a class="header" href="#-statement-number-1-for-10ms-48">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    id integer generated always as identity
        primary key,
    name text,
    email text
)
</code></pre>
<h4 id="locks-at-start-78"><a class="header" href="#locks-at-start-78">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-78"><a class="header" href="#new-locks-taken-78">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-49"><a class="header" href="#-eugene-trace-report-49">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W12/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-49"><a class="header" href="#-statement-number-1-for-10ms-49">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-79"><a class="header" href="#locks-at-start-79">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-79"><a class="header" href="#new-locks-taken-79">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-25"><a class="header" href="#-statement-number-2-for-10ms-25">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene: ignore E2
alter table authors
  alter column name set not null,
  alter column email set not null
</code></pre>
<h4 id="locks-at-start-80"><a class="header" href="#locks-at-start-80">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-80"><a class="header" href="#new-locks-taken-80">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-50"><a class="header" href="#-eugene-lint-report-50">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/W13/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-50"><a class="header" href="#-statement-number-1-50">❌ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create type document_type
    as enum ('invoice', 'receipt', 'other')
</code></pre>
<h4 id="triggered-rules-23"><a class="header" href="#triggered-rules-23">Triggered rules</a></h4>
<h5 id="w13-creating-an-enum-1"><a class="header" href="#w13-creating-an-enum-1"><code>W13</code>: <a href="https://kaveland.no/eugene/hints/W13/">Creating an enum</a></a></h5>
<p>Created enum <code>document_type</code>. Enumerated types are not recommended for use in new applications. Consider using a foreign key to a lookup table instead..</p>
<h3 id="-statement-number-2-26"><a class="header" href="#-statement-number-2-26">✅ Statement number 2</a></h3>
<pre><code class="language-sql">create table document (
    id int generated always as identity
        primary key,
    type document_type
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-51"><a class="header" href="#-eugene-lint-report-51">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W13/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-51"><a class="header" href="#-statement-number-1-51">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table document_type(
    type_name text primary key
)
</code></pre>
<h3 id="-statement-number-2-27"><a class="header" href="#-statement-number-2-27">✅ Statement number 2</a></h3>
<pre><code class="language-sql">insert into document_type
  values('invoice'), ('receipt'), ('other')
</code></pre>
<h3 id="-statement-number-3-5"><a class="header" href="#-statement-number-3-5">✅ Statement number 3</a></h3>
<pre><code class="language-sql">create table document (
    id int generated always as identity
        primary key,
    type text
        references document_type(type_name)
)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-50"><a class="header" href="#-eugene-trace-report-50">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W13/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-50"><a class="header" href="#-statement-number-1-for-10ms-50">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create type document_type
    as enum ('invoice', 'receipt', 'other')
</code></pre>
<h4 id="locks-at-start-81"><a class="header" href="#locks-at-start-81">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-81"><a class="header" href="#new-locks-taken-81">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-26"><a class="header" href="#-statement-number-2-for-10ms-26">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">create table document (
    id int generated always as identity
        primary key,
    type document_type
)
</code></pre>
<h4 id="locks-at-start-82"><a class="header" href="#locks-at-start-82">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-82"><a class="header" href="#new-locks-taken-82">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-51"><a class="header" href="#-eugene-trace-report-51">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W13/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-51"><a class="header" href="#-statement-number-1-for-10ms-51">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table document_type(
    type_name text primary key
)
</code></pre>
<h4 id="locks-at-start-83"><a class="header" href="#locks-at-start-83">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-83"><a class="header" href="#new-locks-taken-83">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-27"><a class="header" href="#-statement-number-2-for-10ms-27">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">insert into document_type
  values('invoice'), ('receipt'), ('other')
</code></pre>
<h4 id="locks-at-start-84"><a class="header" href="#locks-at-start-84">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-84"><a class="header" href="#new-locks-taken-84">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-3-for-10ms-5"><a class="header" href="#-statement-number-3-for-10ms-5">✅ Statement number 3 for 10ms</a></h3>
<pre><code class="language-sql">create table document (
    id int generated always as identity
        primary key,
    type text
        references document_type(type_name)
)
</code></pre>
<h4 id="locks-at-start-85"><a class="header" href="#locks-at-start-85">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-85"><a class="header" href="#new-locks-taken-85">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-52"><a class="header" href="#-eugene-lint-report-52">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W14/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-52"><a class="header" href="#-statement-number-1-52">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    name text
)
</code></pre>
<h2 id="-eugene-lint-report-53"><a class="header" href="#-eugene-lint-report-53">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W14/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-53"><a class="header" href="#-statement-number-1-53">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
create unique index concurrently
    authors_name_key on authors(name)
</code></pre>
<h2 id="-eugene-lint-report-54"><a class="header" href="#-eugene-lint-report-54">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/W14/bad/3.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-54"><a class="header" href="#-statement-number-1-54">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-28"><a class="header" href="#-statement-number-2-28">❌ Statement number 2</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint authors_name_pkey
        primary key using index authors_name_key
</code></pre>
<h4 id="triggered-rules-24"><a class="header" href="#triggered-rules-24">Triggered rules</a></h4>
<h5 id="w14-adding-a-primary-key-using-an-index-1"><a class="header" href="#w14-adding-a-primary-key-using-an-index-1"><code>W14</code>: <a href="https://kaveland.no/eugene/hints/W14/">Adding a primary key using an index</a></a></h5>
<p>New primary key constraint using index on <code>public.authors</code>, may cause postgres to <code>SET NOT NULL</code> on columns in the index. This lint may be a false positive if the columns are already <code>NOT NULL</code>, ignore it by commenting the statement with <code>-- eugene: ignore W14</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-55"><a class="header" href="#-eugene-lint-report-55">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W14/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-55"><a class="header" href="#-statement-number-1-55">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    name text
)
</code></pre>
<h2 id="-eugene-lint-report-56"><a class="header" href="#-eugene-lint-report-56">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W14/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-56"><a class="header" href="#-statement-number-1-56">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
create unique index concurrently
    authors_name_key on authors(name)
</code></pre>
<h2 id="-eugene-lint-report-57"><a class="header" href="#-eugene-lint-report-57">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/W14/good/3.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-57"><a class="header" href="#-statement-number-1-57">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-29"><a class="header" href="#-statement-number-2-29">✅ Statement number 2</a></h3>
<pre><code class="language-sql">-- eugene: ignore E2
-- This is a demo of W14, so we can ignore E2 instead of the
-- multi-step migration to make the column NOT NULL safely
alter table authors
    alter column name set not null
</code></pre>
<h2 id="-eugene-lint-report-58"><a class="header" href="#-eugene-lint-report-58">❌ Eugene lint report</a></h2>
<p>Script name: <code>examples/W14/good/4.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-58"><a class="header" href="#-statement-number-1-58">❌ Statement number 1</a></h3>
<pre><code class="language-sql">-- 4.sql
alter table authors
    add constraint authors_name_pkey
        primary key using index authors_name_key
</code></pre>
<h4 id="triggered-rules-25"><a class="header" href="#triggered-rules-25">Triggered rules</a></h4>
<h5 id="e9-taking-dangerous-lock-without-timeout-3"><a class="header" href="#e9-taking-dangerous-lock-without-timeout-3"><code>E9</code>: <a href="https://kaveland.no/eugene/hints/E9/">Taking dangerous lock without timeout</a></a></h5>
<p>Statement takes lock on <code>public.authors</code>, but does not set a lock timeout.</p>
<h5 id="w14-adding-a-primary-key-using-an-index-2"><a class="header" href="#w14-adding-a-primary-key-using-an-index-2"><code>W14</code>: <a href="https://kaveland.no/eugene/hints/W14/">Adding a primary key using an index</a></a></h5>
<p>New primary key constraint using index on <code>public.authors</code>, may cause postgres to <code>SET NOT NULL</code> on columns in the index. This lint may be a false positive if the columns are already <code>NOT NULL</code>, ignore it by commenting the statement with <code>-- eugene: ignore W14</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-52"><a class="header" href="#-eugene-trace-report-52">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W14/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-52"><a class="header" href="#-statement-number-1-for-10ms-52">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    name text
)
</code></pre>
<h4 id="locks-at-start-86"><a class="header" href="#locks-at-start-86">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-86"><a class="header" href="#new-locks-taken-86">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-53"><a class="header" href="#-eugene-trace-report-53">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W14/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-53"><a class="header" href="#-statement-number-1-for-10ms-53">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
create unique index concurrently
    authors_name_key on authors(name)
</code></pre>
<h4 id="locks-at-start-87"><a class="header" href="#locks-at-start-87">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-87"><a class="header" href="#new-locks-taken-87">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-54"><a class="header" href="#-eugene-trace-report-54">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/W14/bad/3.sql</code></p>
<h3 id="-statement-number-1-for-10ms-54"><a class="header" href="#-statement-number-1-for-10ms-54">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-88"><a class="header" href="#locks-at-start-88">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-88"><a class="header" href="#new-locks-taken-88">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-28"><a class="header" href="#-statement-number-2-for-10ms-28">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">alter table authors
    add constraint authors_name_pkey
        primary key using index authors_name_key
</code></pre>
<h4 id="locks-at-start-89"><a class="header" href="#locks-at-start-89">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-89"><a class="header" href="#new-locks-taken-89">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-26"><a class="header" href="#triggered-rules-26">Triggered rules</a></h4>
<h5 id="e1-validating-table-with-a-new-constraint-3"><a class="header" href="#e1-validating-table-with-a-new-constraint-3"><code>E1</code>: <a href="https://kaveland.no/eugene/hints/E1/">Validating table with a new constraint</a></a></h5>
<p>A new constraint <code>authors_name_pkey</code> of type <code>PRIMARY KEY</code> was added to the table <code>public.authors</code> as <code>VALID</code>. Constraints that are <code>NOT VALID</code> can be made <code>VALID</code> by <code>ALTER TABLE public.authors VALIDATE CONSTRAINT authors_name_pkey</code> which takes a lesser lock.</p>
<h5 id="e2-validating-table-with-a-new-not-null-column-4"><a class="header" href="#e2-validating-table-with-a-new-not-null-column-4"><code>E2</code>: <a href="https://kaveland.no/eugene/hints/E2/">Validating table with a new <code>NOT NULL</code> column</a></a></h5>
<p>The column <code>name</code> in the table <code>public.authors</code> was changed to <code>NOT NULL</code>. If there is a <code>CHECK (name IS NOT NULL)</code> constraint on <code>public.authors</code>, this is safe. Splitting this kind of change into 3 steps can make it safe:</p>
<ol>
<li>Add a <code>CHECK (name IS NOT NULL) NOT VALID;</code> constraint on <code>public.authors</code>.</li>
<li>Validate the constraint in a later transaction, with <code>ALTER TABLE public.authors VALIDATE CONSTRAINT ...</code>.</li>
<li>Make the column <code>NOT NULL</code></li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-55"><a class="header" href="#-eugene-trace-report-55">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W14/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-55"><a class="header" href="#-statement-number-1-for-10ms-55">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table authors(
    name text
)
</code></pre>
<h4 id="locks-at-start-90"><a class="header" href="#locks-at-start-90">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-90"><a class="header" href="#new-locks-taken-90">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-56"><a class="header" href="#-eugene-trace-report-56">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W14/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-56"><a class="header" href="#-statement-number-1-for-10ms-56">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
create unique index concurrently
    authors_name_key on authors(name)
</code></pre>
<h4 id="locks-at-start-91"><a class="header" href="#locks-at-start-91">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-91"><a class="header" href="#new-locks-taken-91">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-57"><a class="header" href="#-eugene-trace-report-57">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/W14/good/3.sql</code></p>
<h3 id="-statement-number-1-for-10ms-57"><a class="header" href="#-statement-number-1-for-10ms-57">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 3.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-92"><a class="header" href="#locks-at-start-92">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-92"><a class="header" href="#new-locks-taken-92">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-29"><a class="header" href="#-statement-number-2-for-10ms-29">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene: ignore E2
-- This is a demo of W14, so we can ignore E2 instead of the
-- multi-step migration to make the column NOT NULL safely
alter table authors
    alter column name set not null
</code></pre>
<h4 id="locks-at-start-93"><a class="header" href="#locks-at-start-93">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-93"><a class="header" href="#new-locks-taken-93">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h2 id="-eugene-trace-report-58"><a class="header" href="#-eugene-trace-report-58">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/W14/good/4.sql</code></p>
<h3 id="-statement-number-1-for-10ms-58"><a class="header" href="#-statement-number-1-for-10ms-58">❌ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 4.sql
alter table authors
    add constraint authors_name_pkey
        primary key using index authors_name_key
</code></pre>
<h4 id="locks-at-start-94"><a class="header" href="#locks-at-start-94">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-94"><a class="header" href="#new-locks-taken-94">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>authors</code></td><td><code>AccessExclusiveLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-27"><a class="header" href="#triggered-rules-27">Triggered rules</a></h4>
<h5 id="e1-validating-table-with-a-new-constraint-4"><a class="header" href="#e1-validating-table-with-a-new-constraint-4"><code>E1</code>: <a href="https://kaveland.no/eugene/hints/E1/">Validating table with a new constraint</a></a></h5>
<p>A new constraint <code>authors_name_pkey</code> of type <code>PRIMARY KEY</code> was added to the table <code>public.authors</code> as <code>VALID</code>. Constraints that are <code>NOT VALID</code> can be made <code>VALID</code> by <code>ALTER TABLE public.authors VALIDATE CONSTRAINT authors_name_pkey</code> which takes a lesser lock.</p>
<h5 id="e9-taking-dangerous-lock-without-timeout-4"><a class="header" href="#e9-taking-dangerous-lock-without-timeout-4"><code>E9</code>: <a href="https://kaveland.no/eugene/hints/E9/">Taking dangerous lock without timeout</a></a></h5>
<p>The statement took <code>AccessExclusiveLock</code> on the Table <code>public.authors</code> without a timeout. It blocks <code>SELECT</code>, <code>FOR UPDATE</code>, <code>FOR NO KEY UPDATE</code>, <code>FOR SHARE</code>, <code>FOR KEY SHARE</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>INSERT</code>, <code>MERGE</code> while waiting to acquire the lock.</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-59"><a class="header" href="#-eugene-lint-report-59">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E15/bad/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-59"><a class="header" href="#-statement-number-1-59">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table items
(
    id bigint generated always as identity primary key
)
</code></pre>
<h3 id="-statement-number-2-30"><a class="header" href="#-statement-number-2-30">✅ Statement number 2</a></h3>
<pre><code class="language-sql">create table purchase
(
    id   bigint generated always as identity primary key,
    item bigint not null references items (id) -- no index
)
</code></pre>
<h2 id="-eugene-lint-report-60"><a class="header" href="#-eugene-lint-report-60">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E15/bad/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-60"><a class="header" href="#-statement-number-1-60">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-31"><a class="header" href="#-statement-number-2-31">✅ Statement number 2</a></h3>
<pre><code class="language-sql">-- eugene: ignore E6
create index purchase_item_idx on purchase (item)
    -- this is a partial index, not good enough for enforcing referential integrity
    where item = 1
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-lint-report-61"><a class="header" href="#-eugene-lint-report-61">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E15/good/1.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-61"><a class="header" href="#-statement-number-1-61">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 1.sql
create table items
(
    id bigint generated always as identity primary key
)
</code></pre>
<h3 id="-statement-number-2-32"><a class="header" href="#-statement-number-2-32">✅ Statement number 2</a></h3>
<pre><code class="language-sql">create table purchase
(
    id   bigint generated always as identity primary key,
    item bigint not null references items (id)
)
</code></pre>
<h2 id="-eugene-lint-report-62"><a class="header" href="#-eugene-lint-report-62">✅ Eugene lint report</a></h2>
<p>Script name: <code>examples/E15/good/2.sql</code></p>
<p>This is a human readable SQL lint report generated by <a href="https://github.com/kaaveland/eugene">eugene</a>.
Keep in mind that lint rules can be ignored in the following two ways:</p>
<ol>
<li>By appending comment directives like <code>-- eugene: ignore E123</code> to the SQL statement.</li>
<li>By passing <code>--ignore E123</code> on the command line.</li>
</ol>
<h3 id="-statement-number-1-62"><a class="header" href="#-statement-number-1-62">✅ Statement number 1</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h3 id="-statement-number-2-33"><a class="header" href="#-statement-number-2-33">✅ Statement number 2</a></h3>
<pre><code class="language-sql">-- eugene: ignore E6
create index purchase_item_idx on purchase(item)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-59"><a class="header" href="#-eugene-trace-report-59">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E15/bad/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-59"><a class="header" href="#-statement-number-1-for-10ms-59">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table items
(
    id bigint generated always as identity primary key
)
</code></pre>
<h4 id="locks-at-start-95"><a class="header" href="#locks-at-start-95">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-95"><a class="header" href="#new-locks-taken-95">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-30"><a class="header" href="#-statement-number-2-for-10ms-30">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">create table purchase
(
    id   bigint generated always as identity primary key,
    item bigint not null references items (id) -- no index
)
</code></pre>
<h4 id="locks-at-start-96"><a class="header" href="#locks-at-start-96">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-96"><a class="header" href="#new-locks-taken-96">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-60"><a class="header" href="#-eugene-trace-report-60">❌ Eugene trace report</a></h2>
<p>Script name: <code>examples/E15/bad/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-60"><a class="header" href="#-statement-number-1-for-10ms-60">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-97"><a class="header" href="#locks-at-start-97">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-97"><a class="header" href="#new-locks-taken-97">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-31"><a class="header" href="#-statement-number-2-for-10ms-31">❌ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene: ignore E6
create index purchase_item_idx on purchase (item)
    -- this is a partial index, not good enough for enforcing referential integrity
    where item = 1
</code></pre>
<h4 id="locks-at-start-98"><a class="header" href="#locks-at-start-98">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-98"><a class="header" href="#new-locks-taken-98">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>purchase</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
<h4 id="triggered-rules-28"><a class="header" href="#triggered-rules-28">Triggered rules</a></h4>
<h5 id="e15-missing-index-1"><a class="header" href="#e15-missing-index-1"><code>E15</code>: <a href="https://kaveland.no/eugene/hints/E15/">Missing index</a></a></h5>
<p>Missing index for <code>purchase_item_fkey</code> detected, create it with:</p>
<pre><code class="language-sql">create index concurrently "purchase_item_fkey_idx" on "public"."purchase"(item);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="-eugene-trace-report-61"><a class="header" href="#-eugene-trace-report-61">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E15/good/1.sql</code></p>
<h3 id="-statement-number-1-for-10ms-61"><a class="header" href="#-statement-number-1-for-10ms-61">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 1.sql
create table items
(
    id bigint generated always as identity primary key
)
</code></pre>
<h4 id="locks-at-start-99"><a class="header" href="#locks-at-start-99">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-99"><a class="header" href="#new-locks-taken-99">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-32"><a class="header" href="#-statement-number-2-for-10ms-32">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">create table purchase
(
    id   bigint generated always as identity primary key,
    item bigint not null references items (id)
)
</code></pre>
<h4 id="locks-at-start-100"><a class="header" href="#locks-at-start-100">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-100"><a class="header" href="#new-locks-taken-100">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h2 id="-eugene-trace-report-62"><a class="header" href="#-eugene-trace-report-62">✅ Eugene trace report</a></h2>
<p>Script name: <code>examples/E15/good/2.sql</code></p>
<h3 id="-statement-number-1-for-10ms-62"><a class="header" href="#-statement-number-1-for-10ms-62">✅ Statement number 1 for 10ms</a></h3>
<pre><code class="language-sql">-- 2.sql
set local lock_timeout = '2s'
</code></pre>
<h4 id="locks-at-start-101"><a class="header" href="#locks-at-start-101">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-101"><a class="header" href="#new-locks-taken-101">New locks taken</a></h4>
<p>No new locks taken by this statement.</p>
<h3 id="-statement-number-2-for-10ms-33"><a class="header" href="#-statement-number-2-for-10ms-33">✅ Statement number 2 for 10ms</a></h3>
<pre><code class="language-sql">-- eugene: ignore E6
create index purchase_item_idx on purchase(item)
</code></pre>
<h4 id="locks-at-start-102"><a class="header" href="#locks-at-start-102">Locks at start</a></h4>
<p>No locks held at the start of this statement.</p>
<h4 id="new-locks-taken-102"><a class="header" href="#new-locks-taken-102">New locks taken</a></h4>
<div class="table-wrapper"><table><thead><tr><th>Schema</th><th>Object</th><th>Mode</th><th>Relkind</th><th>OID</th><th>Safe</th><th>Duration held (ms)</th></tr></thead><tbody>
<tr><td><code>public</code></td><td><code>purchase</code></td><td><code>ShareLock</code></td><td>Table</td><td>1</td><td>❌</td><td>10</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
